{"id":"bd-10p","title":"Conflict: Implement confirm_restore function","description":"# Implement confirm_restore Function\n\n## Task\n\nCreate a function that prompts for user confirmation before restore.\n\n## Implementation\n\n```bash\nconfirm_restore() {\n    # If force mode, skip confirmation\n    if [[ \"$FORCE\" == \"true\" ]]; then\n        log_debug \"Skipping confirmation (--force)\"\n        return 0\n    fi\n    \n    # If dry-run mode, don't prompt (we're not actually doing anything)\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        return 0\n    fi\n    \n    # Check if we're in a TTY\n    if [[ ! -t 0 ]]; then\n        log_error \"Restore requires confirmation.\"\n        log_error \"Use --force for non-interactive mode, or run interactively.\"\n        return 1\n    fi\n    \n    # Prompt for confirmation\n    printf 'Proceed with restore? [y/N] '\n    local response\n    IFS= read -r response\n    \n    case \"$response\" in\n        [yY]|[yY][eE][sS])\n            return 0\n            ;;\n        *)\n            log_info \"Restore cancelled\"\n            return 1\n            ;;\n    esac\n}\n```\n\n## Design Decisions\n\n### Default is NO\n\n- Pressing Enter with no input = cancel\n- Only explicit 'y' or 'yes' proceeds\n- This is the safe default for destructive operations\n\n### Non-TTY Behavior\n\nWhen stdin is not a terminal (piped or scripted):\n- Cannot prompt user\n- Require --force flag\n- Provides clear error message with solution\n\n### Integration with Dry-Run\n\nIf DRY_RUN is true, confirm_restore returns success immediately.\nThis allows dry-run to show the preview without prompting.\n\n## Testing\n\n```bash\n# Interactive - should prompt\nasb restore claude\n\n# Force - should skip prompt\nasb --force restore claude\n\n# Piped - should error without --force\necho \"y\" | asb restore claude  # Error!\necho \"y\" | asb --force restore claude  # Works\n\n# Dry-run - should not prompt\nasb --dry-run restore claude\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T21:24:47.222965562Z","created_by":"ubuntu","updated_at":"2026-01-20T02:43:29.563192107Z","closed_at":"2026-01-20T02:43:29.563106646Z","close_reason":"confirm_restore function already implemented with force/dry-run support and TTY detection","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-10p","depends_on_id":"bd-2aw","type":"blocks","created_at":"2026-01-19T21:28:55.768533787Z","created_by":"ubuntu"},{"issue_id":"bd-10p","depends_on_id":"bd-3co","type":"parent-child","created_at":"2026-01-19T21:24:47.233573914Z","created_by":"ubuntu"}]}
{"id":"bd-170","title":"Export: Register export and import commands in main()","description":"# Register export and import Commands\n\n## Task\n\nAdd export and import to the command dispatch in main().\n\n## Implementation\n\nAdd to the case statement in main():\n\n```bash\ncase \"$command\" in\n    backup|b)\n        backup_all \"$@\"\n        ;;\n    restore|r)\n        if [[ $# -lt 1 ]]; then\n            log_error \"Usage: asb restore <agent> [commit]\"\n            exit 1\n        fi\n        restore_agent \"$@\"\n        ;;\n    export|ex)\n        if [[ $# -lt 1 ]]; then\n            log_error \"Usage: asb export <agent> [file]\"\n            exit 1\n        fi\n        local agent=\"$1\"\n        shift\n        if ! agent_exists \"$agent\"; then\n            log_error \"Unknown agent: ${agent}\"\n            log_info \"Run 'asb list' to see available agents\"\n            exit 1\n        fi\n        export_backup \"$agent\" \"$@\"\n        ;;\n    import|im)\n        if [[ $# -lt 1 ]]; then\n            log_error \"Usage: asb import <file>\"\n            exit 1\n        fi\n        import_backup \"$@\"\n        ;;\n    # ... rest of commands ...\nesac\n```\n\n## Command Aliases\n\n- `export` or `ex` for export\n- `import` or `im` for import\n\nShort aliases follow the pattern of other commands (backup/b, restore/r, etc.)\n\n## Argument Validation\n\n- export requires agent name, file is optional (defaults to timestamped name)\n- import requires archive path\n- Both support \"-\" for stdin/stdout","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:25:57.453450315Z","created_by":"ubuntu","updated_at":"2026-01-20T04:00:18.309698091Z","closed_at":"2026-01-20T04:00:18.309588985Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-170","depends_on_id":"bd-29l","type":"blocks","created_at":"2026-01-19T21:29:06.084345918Z","created_by":"ubuntu"},{"issue_id":"bd-170","depends_on_id":"bd-3jx","type":"blocks","created_at":"2026-01-19T21:29:06.258621043Z","created_by":"ubuntu"},{"issue_id":"bd-170","depends_on_id":"bd-v3p","type":"parent-child","created_at":"2026-01-19T21:25:57.464457247Z","created_by":"ubuntu"}]}
{"id":"bd-18r","title":"Dry-run: Modify backup_agent for dry-run mode","description":"# Modify backup_agent for Dry-Run Mode\n\n## Task\n\nAdd dry-run handling to backup_agent() function.\n\n## Implementation\n\nAdd early return at the start of backup_agent():\n\n```bash\nbackup_agent() {\n    local agent=\"$1\"\n    local source\n    local dest\n    local agent_name=\"${AGENT_NAMES[$agent]:-$agent}\"\n\n    source=$(get_agent_source \"$agent\")\n    dest=$(get_agent_backup_dir \"$agent\")\n\n    if [[ ! -d \"$source\" ]]; then\n        log_warn \"${agent_name} not found at ${source}\"\n        return 1\n    fi\n\n    # === DRY RUN MODE ===\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        log_info \"${DIM}[DRY RUN]${RESET} Would backup ${agent_name}\"\n        log_info \"${DIM}[DRY RUN]${RESET} Source: ${source}\"\n        log_info \"${DIM}[DRY RUN]${RESET} Destination: ${dest}\"\n        \n        # Show what files would change\n        if command_exists rsync; then\n            local changes\n            changes=$(rsync -a --dry-run --itemize-changes \\\n                --exclude='.git' \\\n                --exclude='.gitignore' \\\n                --exclude='*.log' \\\n                --exclude='cache/' \\\n                --exclude='Cache/' \\\n                --exclude='.cache/' \\\n                --exclude='*.sqlite3-wal' \\\n                --exclude='*.sqlite3-shm' \\\n                \"$source/\" \"$dest/\" 2>/dev/null | head -30)\n            \n            if [[ -n \"$changes\" ]]; then\n                log_info \"${DIM}[DRY RUN]${RESET} Files that would be synced:\"\n                echo \"$changes\" | while read -r line; do\n                    echo \"  $line\"\n                done\n            else\n                log_info \"${DIM}[DRY RUN]${RESET} No file changes detected\"\n            fi\n        fi\n        \n        # Check if commit would be created\n        if [[ \"${ASB_AUTO_COMMIT:-true}\" == \"true\" ]]; then\n            if [[ -d \"$dest/.git\" ]]; then\n                log_info \"${DIM}[DRY RUN]${RESET} Would create backup commit\"\n            else\n                log_info \"${DIM}[DRY RUN]${RESET} Would initialize git repo and create initial commit\"\n            fi\n        fi\n        \n        return 0\n    fi\n    # === END DRY RUN MODE ===\n\n    # ... rest of existing implementation unchanged ...\n}\n```\n\n## rsync Itemize Changes\n\nThe `--itemize-changes` flag produces output like:\n```\n>f..t...... settings.json      # file, timestamp changed\n>f.st...... config.yaml        # file, size and timestamp changed  \n.d..t...... projects/          # directory, timestamp changed\n```\n\nThis gives users detailed insight into what would be synced.\n\n## Edge Cases\n\n- If destination doesn't exist yet, rsync will show all files as new\n- We limit output to 30 lines to avoid overwhelming output\n- We check if git repo exists to determine \"would initialize\" vs \"would commit\"","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:23:29.973427440Z","created_by":"ubuntu","updated_at":"2026-01-20T04:29:20.732360235Z","closed_at":"2026-01-20T04:29:20.732246421Z","close_reason":"backup_agent dry-run already implemented; cleaned redundant is_dry_run check and used is_truthy for commit preview","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-18r","depends_on_id":"bd-26s","type":"parent-child","created_at":"2026-01-19T21:23:29.988384823Z","created_by":"ubuntu"},{"issue_id":"bd-18r","depends_on_id":"bd-2lk","type":"blocks","created_at":"2026-01-19T21:28:44.944634479Z","created_by":"ubuntu"}]}
{"id":"bd-1as","title":"Dry-run: Update help text with dry-run flag","description":"# Update Help Text for Dry-Run\n\n## Task\n\nUpdate show_help() to document the --dry-run flag.\n\n## Changes\n\nAdd to USAGE section:\n```bash\n${BOLD}USAGE${RESET}\n    asb [OPTIONS] <command> [args]\n\n${BOLD}OPTIONS${RESET}\n    -n, --dry-run    Show what would happen without making changes\n    -v, --verbose    Show detailed debug output\n```\n\nAdd to EXAMPLES section:\n```bash\n${BOLD}EXAMPLES${RESET}\n    asb backup                  # Backup all detected agents\n    asb --dry-run backup        # Preview backup without changes\n    asb -n backup claude        # Preview backup of specific agent\n    asb backup claude codex     # Backup specific agents\n    # ... existing examples ...\n```\n\n## Also Update\n\nUpdate the brief description at the top of help:\n```\nBacks up AI coding agent configuration folders to git-versioned repositories.\nUse --dry-run to preview changes before making them.\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T21:23:30.382737214Z","created_by":"ubuntu","updated_at":"2026-01-20T04:03:26.366796882Z","closed_at":"2026-01-20T04:03:26.366673219Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1as","depends_on_id":"bd-18r","type":"blocks","created_at":"2026-01-19T21:28:45.447556717Z","created_by":"ubuntu"},{"issue_id":"bd-1as","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-19T21:28:45.600537845Z","created_by":"ubuntu"},{"issue_id":"bd-1as","depends_on_id":"bd-26s","type":"parent-child","created_at":"2026-01-19T21:23:30.398229264Z","created_by":"ubuntu"},{"issue_id":"bd-1as","depends_on_id":"bd-g6l","type":"blocks","created_at":"2026-01-19T21:28:45.763617753Z","created_by":"ubuntu"}]}
{"id":"bd-1gy","title":"Manual Acceptance Testing: Human verification checklist","description":"# Manual Acceptance Testing: Human Verification Checklist\n\n## Purpose\nThis bead tracks MANUAL acceptance testing that requires human judgment and verification. This complements the automated unit tests and E2E tests.\n\n## When to Use This Checklist\n- After all automated tests pass\n- Before release\n- When testing subjective qualities (UX, messaging clarity)\n\n## Manual Verification Checklist\n\n### User Experience\n\n#### Configuration File UX\n- [ ] `asb config init` output is clear and helpful\n- [ ] `asb config show` is well-formatted and readable\n- [ ] Error messages for invalid config are helpful\n\n#### Dry-Run UX\n- [ ] Dry-run output clearly indicates no changes made\n- [ ] Preview shows enough detail to understand what WOULD happen\n- [ ] Colors are helpful (not distracting)\n\n#### Conflict Detection UX\n- [ ] Preview of restore changes is easy to understand\n- [ ] Deletions are CLEARLY marked (users must understand data loss)\n- [ ] Confirmation prompt is unambiguous\n- [ ] \"y to proceed, any other key to cancel\" is clear\n\n#### Export/Import UX\n- [ ] Archive filename is sensible (date-based)\n- [ ] Import prompts before overwriting are clear\n- [ ] Progress indication for large archives\n\n#### Shell Completion UX\n- [ ] Completion instructions in help are easy to follow\n- [ ] Completions feel natural and responsive\n- [ ] No unexpected completions\n\n### Help Text Review\n- [ ] All new commands documented in `asb --help`\n- [ ] All new flags documented\n- [ ] Examples are accurate and work\n- [ ] No typos or grammatical errors\n\n### Edge Cases (Manual Verification)\n- [ ] What happens with no backup directory?\n- [ ] What happens with no git installed?\n- [ ] What happens with read-only filesystem?\n- [ ] What happens with very long filenames?\n- [ ] What happens with special characters in filenames?\n- [ ] What happens on Windows Subsystem for Linux?\n\n### Backward Compatibility\n- [ ] Existing backups from v0.1 still work\n- [ ] No breaking changes to existing commands\n- [ ] Upgrade path is smooth\n\n### Documentation Review\n- [ ] README.md is accurate and complete\n- [ ] All examples work as shown\n- [ ] Installation instructions are correct\n- [ ] Screenshots (if any) are up to date\n\n## Test Environments\nTest manually on:\n- [ ] Ubuntu/Debian\n- [ ] macOS (if available)\n- [ ] Different terminal emulators\n\n## Sign-off\n- [ ] Developer self-review complete\n- [ ] All automated tests passing\n- [ ] All manual checks above verified\n- [ ] Ready for release\n\n## Notes\nAutomated tests are in separate beads:\n- bd-3ig: Test Infrastructure\n- bd-9rp: Unit Test: Configuration File\n- bd-3hq: Unit Test: Dry-Run Mode\n- bd-shi: Unit Test: Conflict Detection\n- bd-k47: Unit Test: Import/Export\n- bd-34i: Unit Test: Shell Completion\n- bd-3sg: E2E Test Suite","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-19T21:27:57.355820416Z","created_by":"ubuntu","updated_at":"2026-01-19T21:41:46.771896303Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1gy","depends_on_id":"bd-3sg","type":"blocks","created_at":"2026-01-19T21:41:46.771879Z","created_by":"ubuntu"},{"issue_id":"bd-1gy","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:27:57.370667010Z","created_by":"ubuntu"}]}
{"id":"bd-1he","title":"Export: Update help text with export/import commands","description":"# Update Help Text for Export/Import\n\n## Task\n\nUpdate show_help() to document the new export and import commands.\n\n## Changes to COMMANDS section\n\n```bash\n${BOLD}COMMANDS${RESET}\n    backup [agents...]        Backup agent settings (all if none specified)\n    restore <agent> [commit]  Restore agent from backup (prompts for confirmation)\n    export <agent> [file]     Export backup as portable archive\n    import <file>             Import backup from archive\n    list                      List all agents and backup status\n    history <agent>           Show backup history for an agent\n    diff <agent>              Show changes since last backup\n    init                      Initialize backup location\n    config [init|show]        Manage configuration\n    help                      Show this help message\n    version                   Show version\n```\n\n## Add PORTABILITY section\n\n```bash\n${BOLD}PORTABILITY${RESET}\n    Export backups as portable archives for transfer between machines:\n    \n    asb export claude                    # Creates claude-backup-DATE.tar.gz\n    asb export claude my-backup.tar.gz   # Custom filename\n    \n    Import archives:\n    \n    asb import backup.tar.gz             # Import to backup location\n    \n    Piping support (for remote transfer, encryption, cloud storage):\n    \n    asb export claude - | ssh host \"asb import -\"\n    asb export claude - | gpg -c > backup.gpg\n    asb export claude - | aws s3 cp - s3://bucket/backup.tar.gz\n```\n\n## Update EXAMPLES section\n\n```bash\n${BOLD}EXAMPLES${RESET}\n    # ... existing examples ...\n    \n    # Export and import\n    asb export claude                  # Export Claude backup\n    asb import claude-backup.tar.gz    # Import on another machine\n    \n    # Transfer to remote machine\n    asb export claude - | ssh server \"asb import -\"\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T21:25:57.584866864Z","created_by":"ubuntu","updated_at":"2026-01-20T04:03:25.927621853Z","closed_at":"2026-01-20T04:03:25.927493371Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1he","depends_on_id":"bd-170","type":"blocks","created_at":"2026-01-19T21:29:06.415575895Z","created_by":"ubuntu"},{"issue_id":"bd-1he","depends_on_id":"bd-v3p","type":"parent-child","created_at":"2026-01-19T21:25:57.594324187Z","created_by":"ubuntu"}]}
{"id":"bd-1i7","title":"Config: Update help text with config commands","description":"# Update Help Text\n\n## Task\n\nUpdate show_help() function to include the new config commands.\n\n## Changes to COMMANDS section\n\n```bash\n${BOLD}COMMANDS${RESET}\n    backup [agents...]        Backup agent settings (all if none specified)\n    restore <agent> [commit]  Restore agent from backup\n    list                      List all agents and backup status\n    history <agent>           Show backup history for an agent\n    diff <agent>              Show changes since last backup\n    init                      Initialize backup location\n    config [init|show]        Manage configuration         # <-- ADD\n    help                      Show this help message\n    version                   Show version\n```\n\n## Add new CONFIGURATION section\n\n```bash\n${BOLD}CONFIGURATION${RESET}\n    Config file: ~/.config/asb/config (XDG-compliant)\n    \n    Create config:    asb config init\n    View settings:    asb config show\n    \n    Settings can also be set via environment variables.\n    Precedence: config file > environment variable > default\n```\n\n## Update ENVIRONMENT section\n\n```bash\n${BOLD}ENVIRONMENT${RESET}\n    ASB_BACKUP_ROOT       Backup location (default: ~/.agent_settings_backups)\n    ASB_AUTO_COMMIT       Auto-commit on backup (default: true)\n    ASB_VERBOSE           Verbose output (default: false)\n    \n    Tip: Use 'asb config init' to create a persistent config file.\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T21:22:22.540545002Z","created_by":"ubuntu","updated_at":"2026-01-20T04:03:25.694712487Z","closed_at":"2026-01-20T04:03:25.694575599Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1i7","depends_on_id":"bd-1lm","type":"parent-child","created_at":"2026-01-19T21:22:22.557272940Z","created_by":"ubuntu"},{"issue_id":"bd-1i7","depends_on_id":"bd-2jp","type":"blocks","created_at":"2026-01-19T21:28:33.532835015Z","created_by":"ubuntu"},{"issue_id":"bd-1i7","depends_on_id":"bd-2xn","type":"blocks","created_at":"2026-01-19T21:28:33.693316049Z","created_by":"ubuntu"}]}
{"id":"bd-1j1","title":"Config: Add get_config_dir and get_config_file functions","description":"# Add Config Path Functions\n\n## Task\n\nAdd two utility functions to determine config file locations following XDG Base Directory spec.\n\n## Implementation\n\n```bash\nget_config_dir() {\n    echo \"${XDG_CONFIG_HOME:-$HOME/.config}/asb\"\n}\n\nget_config_file() {\n    echo \"$(get_config_dir)/config\"\n}\n```\n\n## Placement\n\nAdd these in the UTILITIES section, after `get_agent_backup_dir()`.\n\n## XDG Compliance\n\nThe XDG Base Directory Specification says:\n- $XDG_CONFIG_HOME defines the base directory for user-specific config files\n- If $XDG_CONFIG_HOME is not set, default to $HOME/.config\n\nThis ensures asb plays nicely with users who have custom XDG setups.\n\n## Testing\n\n```bash\n# Default case\nunset XDG_CONFIG_HOME\n./asb # should use ~/.config/asb/config\n\n# Custom XDG\nexport XDG_CONFIG_HOME=/tmp/myconfig\n./asb # should use /tmp/myconfig/asb/config\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:22:22.134317393Z","created_by":"ubuntu","updated_at":"2026-01-20T03:49:18.458240562Z","closed_at":"2026-01-20T03:49:18.457922804Z","close_reason":"Already implemented get_config_dir/get_config_file in asb utilities","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1j1","depends_on_id":"bd-1lm","type":"parent-child","created_at":"2026-01-19T21:22:22.149049803Z","created_by":"ubuntu"}]}
{"id":"bd-1lm","title":"Feature: Configuration File Support","description":"# Feature: Configuration File Support\n\n## Problem Statement\n\nCurrently asb uses environment variables (ASB_BACKUP_ROOT, ASB_AUTO_COMMIT, ASB_VERBOSE) for\nconfiguration. This approach has significant UX problems:\n\n1. **Invisible**: Users can't easily see what's configured\n2. **Transient**: Settings don't persist across shell sessions unless manually added to RC files\n3. **Scattered**: Users forget where they set variables\n4. **Not self-documenting**: No comments explaining options\n5. **Not portable**: Can't easily transfer settings between machines\n\n## Solution\n\nImplement a configuration file at ~/.config/asb/config (XDG-compliant) that:\n- Is sourced at startup (it's just bash, so compatible with env vars)\n- Takes precedence over environment variables when both exist\n- Is self-documenting with comments\n- Can be created with `asb config init`\n- Can be viewed with `asb config show`\n\n## Technical Design\n\n### Config File Location\n```\n${XDG_CONFIG_HOME:-$HOME/.config}/asb/config\n```\n\n### Config File Format (bash-sourceable)\n```bash\n# asb configuration file\n# Generated by: asb config init\n# Documentation: asb help\n\n# Backup location (default: ~/.agent_settings_backups)\nASB_BACKUP_ROOT=\"$HOME/.agent_settings_backups\"\n\n# Auto-commit on backup (default: true)  \nASB_AUTO_COMMIT=true\n\n# Verbose output (default: false)\nASB_VERBOSE=false\n\n# Future: custom exclusion patterns, agent definitions, etc.\n```\n\n### New Functions\n\n1. `get_config_dir()` - Returns XDG-compliant config directory\n2. `get_config_file()` - Returns path to config file\n3. `load_config()` - Sources config file if it exists\n4. `init_config()` - Creates default config file with comments\n5. `show_config()` - Displays current effective configuration\n\n### New Subcommands\n\n- `asb config` - Show current config (alias for `asb config show`)\n- `asb config init` - Create default config file\n- `asb config show` - Display effective settings\n- `asb config edit` - Open config in $EDITOR (optional nice-to-have)\n\n## Implementation Notes\n\n- Config file is sourced AFTER constants but BEFORE command parsing\n- Environment variables still work (for CI/scripts) but config file takes precedence\n- If config file doesn't exist, behavior is unchanged (backward compatible)\n- The config file itself should be valid bash to allow complex expressions\n\n## Why This Is Foundational\n\nOther features may want configuration options:\n- Dry-run could have a default mode setting\n- Shell completion might have customization\n- Import/export could have default archive location\n\nHaving the config infrastructure first enables cleaner implementation of other features.\n\n## Testing Checklist\n\n- [ ] Config file is created in correct XDG location\n- [ ] Config file is sourced at startup\n- [ ] Config values override defaults\n- [ ] Env vars still work when config doesn't exist\n- [ ] Config precedence: config file > env var > default\n- [ ] `asb config init` is idempotent (doesn't overwrite existing)\n- [ ] `asb config show` displays all effective settings","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-19T21:21:38.822857328Z","created_by":"ubuntu","updated_at":"2026-01-20T04:01:14.065352685Z","closed_at":"2026-01-20T04:01:14.065220226Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1lm","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:21:38.851021296Z","created_by":"ubuntu"}]}
{"id":"bd-1zq","title":"Completion: Update install.sh post-install message","description":"# Update install.sh Post-Install Message\n\n## Task\n\nUpdate the install.sh success message to mention shell completion.\n\n## Implementation\n\nIn the verification section at the end of main():\n\n```bash\nif [[ -x \"$installed_path\" ]]; then\n    log_success \"Installation complete!\"\n    printf '\\n' >&2\n\n    log_info \"Get started with:\"\n    log_info \"  asb init            Initialize backup location\"\n    log_info \"  asb backup          Backup all detected agents\"\n    log_info \"  asb list            Show backup status\"\n    log_info \"  asb help            Show all commands\"\n    \n    printf '\\n' >&2\n    log_info \"Enable tab completion:\"\n    log_info \"  Bash: eval \\\"\\$(asb completion bash)\\\"\"\n    log_info \"  Zsh:  eval \\\"\\$(asb completion zsh)\\\"\"\n    log_info \"  Fish: asb completion fish | source\"\n\n    printf '\\n' >&2\n    log_info \"Documentation: https://github.com/$REPO_OWNER/$REPO_NAME\"\nelse\n    log_error \"Installation may have failed\"\n    exit 1\nfi\n```\n\n## Why This Matters\n\nMost users don't read documentation. Showing completion setup right after install\nincreases the chance they'll enable it, improving their experience.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T21:27:17.751322208Z","created_by":"ubuntu","updated_at":"2026-01-20T04:03:38.464083117Z","closed_at":"2026-01-20T04:03:38.463942352Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1zq","depends_on_id":"bd-39b","type":"parent-child","created_at":"2026-01-19T21:27:17.768219405Z","created_by":"ubuntu"},{"issue_id":"bd-1zq","depends_on_id":"bd-6ic","type":"blocks","created_at":"2026-01-19T21:29:18.507250035Z","created_by":"ubuntu"}]}
{"id":"bd-21c","title":"Dry-run: Update backup_all header and summary for dry-run","description":"# Update backup_all for Dry-Run Output\n\n## Task\n\nModify backup_all() to indicate dry-run mode in header and summary.\n\n## Implementation\n\n```bash\nbackup_all() {\n    local agents=(\"$@\")\n    local backed_up=0\n    local failed=0\n    local skipped=0\n\n    # If no specific agents, backup all detected\n    if [[ ${#agents[@]} -eq 0 ]]; then\n        for agent in \"${!AGENT_FOLDERS[@]}\"; do\n            agents+=(\"$agent\")\n        done\n    fi\n\n    printf '\\n' >&2\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        printf '%b\\n' \"${BOLD}Agent Settings Backup ${DIM}[DRY RUN]${RESET}\" >&2\n    else\n        printf '%b\\n' \"${BOLD}Agent Settings Backup${RESET}\" >&2\n    fi\n    printf '%s\\n' \"─────────────────────────\" >&2\n    printf '\\n' >&2\n\n    for agent in \"${agents[@]}\"; do\n        # ... existing loop unchanged ...\n    done\n\n    printf '\\n' >&2\n    printf '%s\\n' \"─────────────────────────\" >&2\n    \n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        log_info \"[DRY RUN] Would backup ${backed_up}, skip ${skipped}, fail ${failed}\"\n    else\n        log_info \"Summary: ${backed_up} backed up, ${skipped} skipped, ${failed} failed\"\n    fi\n\n    [[ $failed -eq 0 ]]\n}\n```\n\n## UX Considerations\n\nThe [DRY RUN] indicator should be visually distinct:\n- Appears in header so user immediately knows mode\n- Appears in summary as reminder\n- Uses DIM color to be visible but not alarming","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:23:30.104036388Z","created_by":"ubuntu","updated_at":"2026-01-20T04:03:26.585036314Z","closed_at":"2026-01-20T04:03:26.584896200Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-21c","depends_on_id":"bd-18r","type":"blocks","created_at":"2026-01-19T21:28:45.121816039Z","created_by":"ubuntu"},{"issue_id":"bd-21c","depends_on_id":"bd-26s","type":"parent-child","created_at":"2026-01-19T21:23:30.119650889Z","created_by":"ubuntu"}]}
{"id":"bd-21x","title":"Conflict: Update help text with --force flag","description":"# Update Help Text for --force Flag\n\n## Task\n\nUpdate show_help() to document the --force flag and the confirmation behavior.\n\n## Changes\n\nAdd to OPTIONS section:\n```bash\n${BOLD}OPTIONS${RESET}\n    -n, --dry-run    Show what would happen without making changes\n    -f, --force      Skip confirmation prompts (for scripting)\n    -v, --verbose    Show detailed debug output\n```\n\nUpdate restore command description:\n```bash\n${BOLD}COMMANDS${RESET}\n    # ...\n    restore <agent> [commit]  Restore agent from backup (prompts for confirmation)\n    # ...\n```\n\nAdd to EXAMPLES:\n```bash\n${BOLD}EXAMPLES${RESET}\n    # ...\n    asb restore claude              # Restore with confirmation prompt\n    asb restore claude abc1234      # Restore specific commit with confirmation\n    asb --force restore claude      # Restore without confirmation (scripting)\n    asb --dry-run restore claude    # Preview restore without making changes\n```\n\nAdd safety note:\n```bash\n${BOLD}SAFETY${RESET}\n    The restore command shows a preview of changes and requires confirmation\n    before overwriting your current configuration. Use --force to skip this\n    for automated scripts, but use with caution.\n```","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T21:24:47.437836752Z","created_by":"ubuntu","updated_at":"2026-01-20T02:44:18.806931068Z","closed_at":"2026-01-20T02:44:18.806886484Z","close_reason":"done","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-21x","depends_on_id":"bd-2nt","type":"blocks","created_at":"2026-01-19T21:28:56.272144662Z","created_by":"ubuntu"},{"issue_id":"bd-21x","depends_on_id":"bd-3co","type":"parent-child","created_at":"2026-01-19T21:24:47.447999885Z","created_by":"ubuntu"}]}
{"id":"bd-22s","title":"Completion: Implement zsh completion script","description":"# Implement Zsh Completion Script\n\n## Task\n\nCreate the zsh completion script output by `asb completion zsh`.\n\n## Implementation\n\nAdd show_completion_zsh() function:\n\n```bash\nshow_completion_zsh() {\n    cat << 'ZSHCOMP'\n#compdef asb\n# asb zsh completion\n# Install: eval \"$(asb completion zsh)\"\n# Or: asb completion zsh > ~/.zsh/completions/_asb\n\n_asb() {\n    local -a commands agents config_cmds global_opts\n    \n    commands=(\n        'backup:Backup agent settings'\n        'restore:Restore agent from backup'\n        'export:Export backup as archive'\n        'import:Import backup from archive'\n        'list:List all agents and status'\n        'history:Show backup history'\n        'diff:Show changes since last backup'\n        'init:Initialize backup location'\n        'config:Manage configuration'\n        'help:Show help message'\n        'version:Show version'\n    )\n    \n    agents=(\n        'aider:Aider'\n        'amp:Amp (Sourcegraph)'\n        'claude:Claude Code'\n        'cline:Cline'\n        'codex:OpenAI Codex CLI'\n        'cursor:Cursor'\n        'factory:Factory Droid'\n        'gemini:Google Gemini'\n        'opencode:OpenCode'\n        'windsurf:Windsurf'\n    )\n    \n    config_cmds=(\n        'init:Create default config file'\n        'show:Display current settings'\n    )\n    \n    global_opts=(\n        '-n[Dry-run mode]'\n        '--dry-run[Dry-run mode]'\n        '-f[Force mode]'\n        '--force[Force mode]'\n        '-v[Verbose output]'\n        '--verbose[Verbose output]'\n    )\n    \n    _arguments -C \\\n        $global_opts \\\n        '1:command:->command' \\\n        '*::arg:->args'\n    \n    case \"$state\" in\n        command)\n            _describe 'command' commands\n            ;;\n        args)\n            case \"${words[1]}\" in\n                backup|b)\n                    _describe 'agent' agents\n                    ;;\n                restore|r|history|h|log|diff|d|export|ex)\n                    if [[ $CURRENT -eq 2 ]]; then\n                        _describe 'agent' agents\n                    elif [[ $CURRENT -eq 3 && \"${words[1]}\" =~ ^(restore|r)$ ]]; then\n                        # Complete commits\n                        local agent=\"${words[2]}\"\n                        local backup_dir=\"${HOME}/.agent_settings_backups/.${agent}\"\n                        if [[ -d \"$backup_dir/.git\" ]]; then\n                            local -a commits\n                            commits=($(git -C \"$backup_dir\" log --oneline -15 2>/dev/null | cut -d' ' -f1))\n                            commits+=(HEAD)\n                            _describe 'commit' commits\n                        fi\n                    fi\n                    ;;\n                config|cfg)\n                    _describe 'config command' config_cmds\n                    ;;\n                import|im)\n                    _files -g '*.tar.gz'\n                    ;;\n            esac\n            ;;\n    esac\n}\n\n_asb \"$@\"\nZSHCOMP\n}\n```\n\n## Zsh-Specific Features\n\n- Descriptions for commands and agents (shown in completion menu)\n- Proper argument handling with _arguments\n- File globbing for import command\n- Cleaner state machine approach","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:27:16.740264834Z","created_by":"ubuntu","updated_at":"2026-01-20T04:28:54.124713115Z","closed_at":"2026-01-20T04:28:54.124630840Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-22s","depends_on_id":"bd-39b","type":"parent-child","created_at":"2026-01-19T21:27:16.755749971Z","created_by":"ubuntu"}]}
{"id":"bd-26s","title":"Feature: Dry-Run Mode","description":"# Feature: Dry-Run Mode\n\n## Problem Statement\n\nUsers trying asb for the first time naturally ask: \"What will this do to my system?\"\nCurrently there's no way to preview backup operations without actually performing them.\n\nThis creates several problems:\n1. **Trust barrier**: Users hesitate to run a tool that might modify their files\n2. **Debugging difficulty**: When things go wrong, users can't see what the tool tried to do\n3. **Learning curve**: No safe way to experiment and understand the tool\n\n## Solution\n\nAdd --dry-run (-n) flag that shows what WOULD happen without making any changes.\n\n## Technical Design\n\n### New Global Variable\n\n```bash\nDRY_RUN=false\n```\n\n### Flag Parsing\n\nFlags should be parsed before the command arguments:\n\n```bash\n# In main(), before case statement\nwhile [[ $# -gt 0 ]]; do\n    case \"$1\" in\n        -n|--dry-run)\n            DRY_RUN=true\n            shift\n            ;;\n        -*)\n            # Unknown flag - let command handle it or error\n            break\n            ;;\n        *)\n            break\n            ;;\n    esac\ndone\n```\n\n### Modified Functions\n\n**backup_agent()** changes:\n```bash\nbackup_agent() {\n    # ... existing setup ...\n\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        log_info \"[DRY RUN] Would backup ${agent_name}\"\n        log_info \"[DRY RUN] Source: ${source}\"\n        log_info \"[DRY RUN] Destination: ${dest}\"\n        \n        if command_exists rsync; then\n            log_info \"[DRY RUN] Files that would be synced:\"\n            rsync -a --dry-run --itemize-changes \\\n                --exclude='.git' \\\n                --exclude='.gitignore' \\\n                --exclude='*.log' \\\n                --exclude='cache/' \\\n                --exclude='Cache/' \\\n                --exclude='.cache/' \\\n                \"$source/\" \"$dest/\" 2>/dev/null | head -20\n        fi\n        return 0\n    fi\n\n    # ... existing implementation ...\n}\n```\n\n**backup_all()** changes:\n- Add [DRY RUN] prefix to header when in dry-run mode\n- Summary should indicate it was a dry run\n\n### User Experience\n\n```\n$ asb backup --dry-run\n\nAgent Settings Backup [DRY RUN]\n─────────────────────────\n\nℹ [DRY RUN] Would backup Claude Code\nℹ [DRY RUN] Source: /home/user/.claude\nℹ [DRY RUN] Destination: /home/user/.agent_settings_backups/.claude\nℹ [DRY RUN] Files that would be synced:\n>f..t...... settings.json\n>f..t...... projects/recent.json\n\n─────────────────────────\nℹ [DRY RUN] Summary: Would backup 1 agent\n```\n\n### rsync --dry-run Output\n\nThe rsync itemize-changes format shows:\n- `>f` = file being transferred\n- `.d` = directory\n- `..t` = timestamp change\n- `..s` = size change\n- `c` = checksum differs\n\nThis gives users detailed insight into what would change.\n\n## Implementation Notes\n\n- Dry-run should work with ALL commands that modify state (backup, restore, init)\n- For restore, dry-run should show the diff that would be applied\n- Dry-run is READ-ONLY - no git operations, no file copies\n\n## Testing Checklist\n\n- [ ] `asb backup --dry-run` shows what would be backed up\n- [ ] `asb backup -n` works (short flag)\n- [ ] `asb backup -n claude` works (flag before agent)\n- [ ] `asb backup claude -n` works (flag after agent)  \n- [ ] Dry-run makes NO file changes\n- [ ] Dry-run makes NO git commits\n- [ ] Output clearly indicates dry-run mode","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-19T21:22:45.019309259Z","created_by":"ubuntu","updated_at":"2026-01-20T04:19:14.630277325Z","closed_at":"2026-01-20T04:19:14.630189249Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-26s","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:22:45.048018083Z","created_by":"ubuntu"}]}
{"id":"bd-29l","title":"Export: Implement export_backup function","description":"# Implement export_backup Function\n\n## Task\n\nCreate the export_backup() function that creates a portable archive.\n\n## Implementation\n\n```bash\nexport_backup() {\n    local agent=\"$1\"\n    local output=\"${2:-}\"\n    local agent_name=\"${AGENT_NAMES[$agent]:-$agent}\"\n    local source\n    local folder=\"${AGENT_FOLDERS[$agent]}\"\n    \n    source=$(get_agent_backup_dir \"$agent\")\n    \n    # Validate backup exists\n    if [[ ! -d \"$source/.git\" ]]; then\n        log_error \"No backup found for ${agent_name}\"\n        log_info \"Run 'asb backup ${agent}' first\"\n        return 1\n    fi\n    \n    # Generate default filename if not specified\n    if [[ -z \"$output\" ]]; then\n        output=\"${agent}-backup-$(date +%Y%m%d-%H%M%S).tar.gz\"\n    fi\n    \n    # Dry-run mode\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        log_info \"[DRY RUN] Would export ${agent_name}\"\n        log_info \"[DRY RUN] Source: ${source}\"\n        log_info \"[DRY RUN] Output: ${output}\"\n        \n        # Show what would be included\n        local size\n        size=$(du -sh \"$source\" 2>/dev/null | cut -f1)\n        log_info \"[DRY RUN] Archive would contain ${size} of data\"\n        \n        local commit_count\n        commit_count=$(git -C \"$source\" rev-list --count HEAD 2>/dev/null || echo \"?\")\n        log_info \"[DRY RUN] Including ${commit_count} backup commits\"\n        return 0\n    fi\n    \n    log_step \"Exporting ${agent_name}...\"\n    log_debug \"Source: ${source}\"\n    log_debug \"Output: ${output}\"\n    \n    local backup_root\n    backup_root=$(get_backup_root)\n    \n    # Create archive\n    if [[ \"$output\" == \"-\" ]]; then\n        # Write to stdout (for piping)\n        tar -czf - -C \"$backup_root\" \"$folder\" 2>/dev/null\n    else\n        # Write to file\n        if [[ -f \"$output\" ]] && [[ \"$FORCE\" != \"true\" ]]; then\n            log_error \"Output file already exists: ${output}\"\n            log_info \"Use --force to overwrite, or specify different filename\"\n            return 1\n        fi\n        \n        tar -czf \"$output\" -C \"$backup_root\" \"$folder\" 2>/dev/null\n        \n        if [[ ! -f \"$output\" ]]; then\n            log_error \"Failed to create archive\"\n            return 1\n        fi\n        \n        local size\n        size=$(du -h \"$output\" | cut -f1)\n        local commit_count\n        commit_count=$(git -C \"$source\" rev-list --count HEAD 2>/dev/null || echo \"?\")\n        \n        log_success \"Exported ${agent_name}\"\n        printf '\\n'\n        printf \"  File:     %s\\n\" \"$(realpath \"$output\")\"\n        printf \"  Size:     %s\\n\" \"$size\"\n        printf \"  History:  %s commits\\n\" \"$commit_count\"\n    fi\n    \n    return 0\n}\n```\n\n## Archive Contents\n\nThe archive contains:\n```\n.claude/                  # Directory name = agent folder\n├── .git/                 # Full git history\n├── .gitignore           # Exclusion rules\n├── settings.json        # Agent config files\n└── ...                  # Other agent files\n```\n\n## Stdout Mode\n\nWhen output is \"-\", tar writes to stdout:\n- No progress messages (they'd corrupt the stream)\n- Enables piping: `asb export claude - | ssh remote \"asb import -\"`\n- Enables encryption: `asb export claude - | gpg -c > backup.tar.gz.gpg`","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:25:57.197551167Z","created_by":"ubuntu","updated_at":"2026-01-20T04:29:00.424186161Z","closed_at":"2026-01-20T04:29:00.424104126Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-29l","depends_on_id":"bd-v3p","type":"parent-child","created_at":"2026-01-19T21:25:57.226019338Z","created_by":"ubuntu"}]}
{"id":"bd-2aw","title":"Conflict: Add FORCE global variable and flag parsing","description":"# Add FORCE Global Variable and Flag Parsing\n\n## Task\n\nAdd FORCE variable for --force/-f flag that skips restore confirmation.\n\n## Implementation\n\n### Global Variable (in CONSTANTS section)\n\n```bash\n# Force mode - skip confirmations (set via --force or -f flag)\nFORCE=false\n```\n\n### Update Flag Parsing (in main())\n\nAdd to the existing flag parsing loop:\n\n```bash\nwhile [[ $# -gt 0 ]]; do\n    case \"$1\" in\n        -n|--dry-run)\n            DRY_RUN=true\n            shift\n            ;;\n        -f|--force)\n            FORCE=true\n            shift\n            ;;\n        -v|--verbose)\n            ASB_VERBOSE=true\n            shift\n            ;;\n        -*)\n            break\n            ;;\n        *)\n            break\n            ;;\n    esac\ndone\n```\n\n## Design Rationale\n\nThe --force flag is intentionally global (not command-specific) because:\n1. Multiple commands might need confirmation skipping in future\n2. Consistent flag position: `asb --force restore claude`\n3. Follows conventions of tools like `rm -f`, `git checkout -f`\n\n## Safety Note\n\n--force should ONLY skip confirmations, never safety checks.\nFor example, if backup doesn't exist, --force should still error.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T21:24:47.026304081Z","created_by":"ubuntu","updated_at":"2026-01-20T02:43:14.276133528Z","closed_at":"2026-01-20T02:43:14.276091188Z","close_reason":"FORCE global variable and flag parsing already implemented in main()","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2aw","depends_on_id":"bd-3co","type":"parent-child","created_at":"2026-01-19T21:24:47.035893393Z","created_by":"ubuntu"}]}
{"id":"bd-2jp","title":"Config: Implement 'asb config init' subcommand","description":"# Implement config init Subcommand\n\n## Task\n\nAdd `asb config init` command that creates a default config file with helpful comments.\n\n## Implementation\n\n```bash\ninit_config() {\n    local config_dir\n    local config_file\n    config_dir=$(get_config_dir)\n    config_file=$(get_config_file)\n\n    # Create directory if needed\n    if [[ ! -d \"$config_dir\" ]]; then\n        log_step \"Creating config directory: $config_dir\"\n        mkdir -p \"$config_dir\"\n    fi\n\n    # Don't overwrite existing config\n    if [[ -f \"$config_file\" ]]; then\n        log_info \"Config file already exists: $config_file\"\n        log_info \"Edit manually or delete to regenerate\"\n        return 0\n    fi\n\n    log_step \"Creating config file: $config_file\"\n    \n    cat > \"$config_file\" << 'CONFIGEOF'\n# asb (Agent Settings Backup) configuration\n# Generated by: asb config init\n# Documentation: asb help\n#\n# This file is sourced as bash. You can use variables and expressions.\n# Environment variables override these settings.\n\n#-----------------------------------------------------------------------------\n# BACKUP LOCATION\n#-----------------------------------------------------------------------------\n# Where agent settings backups are stored.\n# Each agent gets its own git repository under this directory.\n# Default: ~/.agent_settings_backups\n#\n# ASB_BACKUP_ROOT=\"$HOME/.agent_settings_backups\"\n\n#-----------------------------------------------------------------------------\n# AUTO-COMMIT\n#-----------------------------------------------------------------------------\n# Automatically create a git commit after each backup.\n# Set to \"false\" to stage changes without committing (manual workflow).\n# Default: true\n#\n# ASB_AUTO_COMMIT=true\n\n#-----------------------------------------------------------------------------\n# VERBOSE OUTPUT\n#-----------------------------------------------------------------------------\n# Show detailed debug output during operations.\n# Useful for troubleshooting or understanding what asb is doing.\n# Default: false\n#\n# ASB_VERBOSE=false\n\n#-----------------------------------------------------------------------------\n# FUTURE OPTIONS (not yet implemented)\n#-----------------------------------------------------------------------------\n# Custom exclusion patterns, agent definitions, etc. will go here\n# as asb evolves. See: https://github.com/Dicklesworthstone/agent_settings_backup_script\nCONFIGEOF\n\n    log_success \"Created config file: $config_file\"\n    log_info \"Edit the file to customize your settings\"\n}\n```\n\n## Command Registration\n\nIn main() case statement:\n\n```bash\nconfig|cfg)\n    local config_cmd=\"${1:-show}\"\n    shift || true\n    case \"$config_cmd\" in\n        init)\n            init_config\n            ;;\n        show)\n            show_config  # implemented in separate task\n            ;;\n        *)\n            log_error \"Unknown config command: $config_cmd\"\n            log_info \"Usage: asb config [init|show]\"\n            exit 1\n            ;;\n    esac\n    ;;\n```\n\n## Idempotency\n\nThe function is idempotent - running it multiple times is safe:\n- Directory creation uses mkdir -p (no error if exists)\n- File creation checks for existence first\n- Existing config is never overwritten (user must delete manually)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:22:22.325819507Z","created_by":"ubuntu","updated_at":"2026-01-20T04:29:09.270568841Z","closed_at":"2026-01-20T04:29:09.270485464Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2jp","depends_on_id":"bd-1j1","type":"blocks","created_at":"2026-01-19T21:28:33.213979055Z","created_by":"ubuntu"},{"issue_id":"bd-2jp","depends_on_id":"bd-1lm","type":"parent-child","created_at":"2026-01-19T21:22:22.341870389Z","created_by":"ubuntu"}]}
{"id":"bd-2lk","title":"Dry-run: Add global variable and flag parsing","description":"# Add DRY_RUN Global and Flag Parsing\n\n## Task\n\nAdd the DRY_RUN global variable and implement flag parsing in main().\n\n## Implementation\n\n### Global Variable (in CONSTANTS section)\n\n```bash\n# Dry-run mode (set via --dry-run or -n flag)\nDRY_RUN=false\n```\n\n### Flag Parsing (in main())\n\nAdd flag parsing loop before the case statement:\n\n```bash\nmain() {\n    # Check for git\n    if ! command_exists git; then\n        log_error \"git is required but not installed\"\n        exit 1\n    fi\n\n    # Load configuration\n    load_config\n\n    # Parse global flags\n    while [[ $# -gt 0 ]]; do\n        case \"$1\" in\n            -n|--dry-run)\n                DRY_RUN=true\n                shift\n                ;;\n            -v|--verbose)\n                ASB_VERBOSE=true\n                shift\n                ;;\n            -*)\n                # Unknown flag or command - stop parsing globals\n                break\n                ;;\n            *)\n                # Not a flag - it's a command\n                break\n                ;;\n        esac\n    done\n\n    local command=\"${1:-help}\"\n    shift || true\n\n    # ... rest of case statement ...\n}\n```\n\n## Design Decision: Flag Position\n\nFlags can appear before the command:\n- `asb --dry-run backup claude`\n- `asb -n backup claude`\n\nThis follows the common CLI pattern (like `git --no-pager log`).\n\n## Bonus: Add --verbose Flag\n\nWhile we're here, also add -v/--verbose as a global flag. This was previously\nonly available via ASB_VERBOSE env var.\n\n## Testing\n\n```bash\nasb --dry-run backup    # Should set DRY_RUN=true\nasb -n backup           # Should set DRY_RUN=true\nasb backup              # Should keep DRY_RUN=false\nasb --verbose backup    # Should set ASB_VERBOSE=true\nasb -v -n backup        # Should set both\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:23:29.849278229Z","created_by":"ubuntu","updated_at":"2026-01-20T02:44:18.604412587Z","closed_at":"2026-01-20T02:44:18.604353135Z","close_reason":"done","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2lk","depends_on_id":"bd-26s","type":"parent-child","created_at":"2026-01-19T21:23:29.860649577Z","created_by":"ubuntu"}]}
{"id":"bd-2nt","title":"Conflict: Update restore_agent with preview and confirmation","description":"# Update restore_agent with Preview and Confirmation\n\n## Task\n\nModify restore_agent() to show preview and require confirmation before proceeding.\n\n## Implementation\n\nUpdate restore_agent() to add preview and confirmation:\n\n```bash\nrestore_agent() {\n    local agent=\"$1\"\n    local commit=\"${2:-HEAD}\"\n    local source\n    local dest\n    local agent_name=\"${AGENT_NAMES[$agent]:-$agent}\"\n\n    source=$(get_agent_backup_dir \"$agent\")\n    dest=$(get_agent_source \"$agent\")\n\n    if [[ ! -d \"$source/.git\" ]]; then\n        log_error \"No backup found for ${agent_name}\"\n        return 1\n    fi\n\n    # Validate commit exists\n    if ! git -C \"$source\" rev-parse --verify \"$commit\" >/dev/null 2>&1; then\n        log_error \"Invalid commit: ${commit}\"\n        log_info \"Run 'asb history ${agent}' to see valid commits\"\n        return 1\n    fi\n\n    # Show preview (works in both normal and dry-run mode)\n    if ! show_restore_preview \"$source\" \"$dest\" \"$commit\" \"$agent_name\"; then\n        log_error \"Could not generate restore preview\"\n        return 1\n    fi\n\n    # Dry-run exits here\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        log_info \"[DRY RUN] Would restore ${agent_name} from ${commit}\"\n        return 0\n    fi\n\n    # Get confirmation\n    if ! confirm_restore; then\n        return 1\n    fi\n\n    # === PROCEED WITH RESTORE ===\n    log_step \"Restoring ${agent_name} from backup...\"\n    log_debug \"Backup: ${source}\"\n    log_debug \"Destination: ${dest}\"\n    log_debug \"Commit: ${commit}\"\n\n    # Create destination if needed\n    mkdir -p \"$dest\"\n\n    # If restoring a specific commit, checkout that commit first\n    if [[ \"$commit\" != \"HEAD\" ]]; then\n        git -C \"$source\" checkout \"$commit\" -- . >/dev/null 2>&1 || {\n            log_error \"Failed to checkout commit: ${commit}\"\n            return 1\n        }\n    fi\n\n    # Sync files\n    if command_exists rsync; then\n        rsync -a --delete \\\n            --exclude='.git' \\\n            --exclude='.gitignore' \\\n            \"$source/\" \"$dest/\" 2>/dev/null\n    else\n        # Fallback to cp\n        find \"$dest\" -mindepth 1 -maxdepth 1 -exec rm -rf {} \\; 2>/dev/null\n        cp -r \"$source\"/. \"$dest/\" 2>/dev/null || true\n        rm -rf \"$dest/.git\" \"$dest/.gitignore\" 2>/dev/null\n    fi\n\n    # Reset to HEAD if we checked out a specific commit\n    if [[ \"$commit\" != \"HEAD\" ]]; then\n        git -C \"$source\" checkout HEAD -- . >/dev/null 2>&1\n    fi\n\n    log_success \"Restored ${agent_name} from backup\"\n    return 0\n}\n```\n\n## Key Changes\n\n1. Added commit validation before preview\n2. Call show_restore_preview() early\n3. Dry-run exits after preview\n4. Call confirm_restore() before actual work\n5. Only proceed if confirmation succeeds\n\n## User Experience\n\nThe flow is now:\n1. Show detailed preview\n2. Ask for confirmation\n3. Only then perform restore\n\nThis prevents accidental data loss.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T21:24:47.327307606Z","created_by":"ubuntu","updated_at":"2026-01-20T02:44:02.422494418Z","closed_at":"2026-01-20T02:44:02.422452530Z","close_reason":"restore_agent already updated with commit validation, preview, dry-run handling, and confirmation","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2nt","depends_on_id":"bd-10p","type":"blocks","created_at":"2026-01-19T21:28:56.107154565Z","created_by":"ubuntu"},{"issue_id":"bd-2nt","depends_on_id":"bd-3co","type":"parent-child","created_at":"2026-01-19T21:24:47.337141118Z","created_by":"ubuntu"},{"issue_id":"bd-2nt","depends_on_id":"bd-3dw","type":"blocks","created_at":"2026-01-19T21:28:55.946132312Z","created_by":"ubuntu"}]}
{"id":"bd-2xn","title":"Config: Implement 'asb config show' subcommand","description":"# Implement config show Subcommand\n\n## Task\n\nAdd `asb config show` command that displays current effective configuration.\n\n## Implementation\n\n```bash\nshow_config() {\n    local config_file\n    config_file=$(get_config_file)\n\n    printf '\\n'\n    printf '%b\\n' \"${BOLD}asb Configuration${RESET}\"\n    printf '%s\\n' \"─────────────────────────────\"\n    printf '\\n'\n\n    # Show config file status\n    if [[ -f \"$config_file\" ]]; then\n        printf \"Config file: %s\\n\" \"$config_file\"\n    else\n        printf \"Config file: %s (not created)\\n\" \"$config_file\"\n        log_info \"Run 'asb config init' to create\"\n    fi\n    printf '\\n'\n\n    # Show effective values\n    printf '%b\\n' \"${BOLD}Effective Settings${RESET}\"\n    printf '%s\\n' \"─────────────────────────────\"\n    printf \"%-20s %s\\n\" \"ASB_BACKUP_ROOT:\" \"$(get_backup_root)\"\n    printf \"%-20s %s\\n\" \"ASB_AUTO_COMMIT:\" \"${ASB_AUTO_COMMIT:-true}\"\n    printf \"%-20s %s\\n\" \"ASB_VERBOSE:\" \"${ASB_VERBOSE:-false}\"\n    printf '\\n'\n\n    # Show source of each value (helpful for debugging)\n    printf '%b\\n' \"${DIM}Source: config file > environment > default${RESET}\"\n}\n```\n\n## Default Command\n\n`asb config` with no arguments should run `show`:\n\n```bash\nconfig|cfg)\n    local config_cmd=\"${1:-show}\"  # defaults to show\n```\n\n## Output Example\n\n```\nasb Configuration\n─────────────────────────────\n\nConfig file: /home/user/.config/asb/config\n\nEffective Settings\n─────────────────────────────\nASB_BACKUP_ROOT:     /home/user/.agent_settings_backups\nASB_AUTO_COMMIT:     true\nASB_VERBOSE:         false\n\nSource: config file > environment > default\n```\n\n## Why This Matters\n\nUsers often ask \"what is asb configured to do?\" This gives them a single command\nto see all effective settings, plus tells them where the config file is so they\ncan edit it.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:22:22.430164105Z","created_by":"ubuntu","updated_at":"2026-01-20T04:29:14.047936521Z","closed_at":"2026-01-20T04:29:14.047854717Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2xn","depends_on_id":"bd-1j1","type":"blocks","created_at":"2026-01-19T21:28:33.370334287Z","created_by":"ubuntu"},{"issue_id":"bd-2xn","depends_on_id":"bd-1lm","type":"parent-child","created_at":"2026-01-19T21:22:22.446928621Z","created_by":"ubuntu"}]}
{"id":"bd-30d","title":"Completion: Update help text with completion instructions","description":"# Update Help Text for Completion\n\n## Task\n\nUpdate show_help() to document shell completion setup.\n\n## Changes to COMMANDS section\n\n```bash\n${BOLD}COMMANDS${RESET}\n    # ... existing commands ...\n    completion [shell]    Output shell completion script (bash/zsh/fish)\n```\n\n## Add SHELL COMPLETION section\n\n```bash\n${BOLD}SHELL COMPLETION${RESET}\n    Enable tab completion for commands and agent names:\n    \n    Bash (~/.bashrc):\n        eval \"$(asb completion bash)\"\n    \n    Zsh (~/.zshrc):\n        eval \"$(asb completion zsh)\"\n    \n    Fish (~/.config/fish/config.fish):\n        asb completion fish | source\n    \n    After adding, restart your shell or source the RC file.\n```\n\n## Placement\n\nAdd the SHELL COMPLETION section after EXAMPLES but before ENVIRONMENT.\nThis makes it visible to users looking for setup instructions.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T21:27:17.485577165Z","created_by":"ubuntu","updated_at":"2026-01-20T04:03:26.150219729Z","closed_at":"2026-01-20T04:03:26.150071350Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-30d","depends_on_id":"bd-39b","type":"parent-child","created_at":"2026-01-19T21:27:17.501934054Z","created_by":"ubuntu"},{"issue_id":"bd-30d","depends_on_id":"bd-6ic","type":"blocks","created_at":"2026-01-19T21:29:18.339496113Z","created_by":"ubuntu"}]}
{"id":"bd-34i","title":"Unit Test: Shell Completion tests","description":"# Unit Test: Shell Completion\n\n## Purpose\nCreate an automated test script (tests/test_completion.sh) that verifies shell completion scripts.\n\n## Test Script Requirements\n\n### Setup/Teardown\n- Create isolated shell environments\n- Test in bash, zsh, fish subshells\n- Support --verbose flag for detailed logging\n\n### Test Cases\n\n1. **test_bash_completion_valid**\n   - Run `asb completion bash`\n   - Verify output is valid bash syntax\n   - Run `bash -n` to syntax check\n   - Verify no stderr output\n\n2. **test_zsh_completion_valid**\n   - Run `asb completion zsh`\n   - Verify output is valid zsh syntax\n   - Check for #compdef header\n   - Verify _arguments structure\n\n3. **test_fish_completion_valid**\n   - Run `asb completion fish`\n   - Verify output is valid fish syntax\n   - Check for `complete -c asb` commands\n   - Verify fish_indent passes\n\n4. **test_bash_completion_commands**\n   - Source bash completion\n   - Simulate TAB after `asb `\n   - Verify commands listed: backup, restore, etc.\n\n5. **test_bash_completion_agents**\n   - Source bash completion\n   - Simulate TAB after `asb backup `\n   - Verify agent names listed\n\n6. **test_bash_completion_flags**\n   - Source bash completion\n   - Simulate TAB after `asb --`\n   - Verify flags listed: --help, --dry-run, --force\n\n7. **test_completion_restore_commits**\n   - Create backup with commits\n   - Source bash completion\n   - Simulate TAB after `asb restore agent `\n   - Verify commit hashes offered\n\n8. **test_unknown_shell_error**\n   - Run `asb completion unknown`\n   - Verify helpful error message\n   - Verify lists supported shells\n\n## Completion Testing Strategy\nUse bash's compgen or manual COMP_WORDS testing:\n\\`\\`\\`bash\n# Test completion function\n_test_completion() {\n    COMP_WORDS=(asb backup \"\")\n    COMP_CWORD=2\n    _asb_completions\n    echo \"${COMPREPLY[@]}\"\n}\n\\`\\`\\`\n\n## Shell Availability\n- Test bash if available (required)\n- Test zsh if available (optional, skip if missing)\n- Test fish if available (optional, skip if missing)\n\n## Logging Requirements\n- Each test logs: START, PASS/FAIL, duration\n- Log completion output on failures\n- Show which shells were tested","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:39:44.936465407Z","created_by":"ubuntu","updated_at":"2026-01-20T04:33:24.493718987Z","closed_at":"2026-01-20T04:33:24.493636211Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-34i","depends_on_id":"bd-39b","type":"blocks","created_at":"2026-01-19T21:41:28.368345002Z","created_by":"ubuntu"},{"issue_id":"bd-34i","depends_on_id":"bd-3ig","type":"blocks","created_at":"2026-01-19T21:41:28.159313732Z","created_by":"ubuntu"}]}
{"id":"bd-39b","title":"Feature: Shell Completion","description":"# Feature: Shell Completion\n\n## Problem Statement\n\nWithout tab completion, users must:\n- Remember all command names\n- Remember all agent names\n- Type everything manually\n- Reference help constantly\n\nThis makes the tool feel unpolished and increases friction.\n\n## Solution\n\nProvide tab completion scripts for the three major shells:\n- Bash\n- Zsh\n- Fish\n\n## Technical Design\n\n### User Experience\n\n```bash\n$ asb <TAB>\nbackup    config    diff      export    help      history   import    \ninit      list      restore   version\n\n$ asb backup <TAB>\naider     amp       claude    cline     codex     cursor    factory   \ngemini    opencode  windsurf\n\n$ asb backup cl<TAB>\n$ asb backup claude   # Completed!\n\n$ asb restore claude <TAB>\nabc1234   def5678   ghi9012   # Shows recent commits\n```\n\n### Completion Sources\n\n1. **Commands**: Static list of all subcommands\n2. **Agent names**: From AGENT_FOLDERS keys\n3. **Commits**: Dynamic, from git log of agent's backup repo\n4. **Files**: For import command, complete .tar.gz files\n\n### New Subcommand\n\n```bash\nasb completion [bash|zsh|fish]\n```\n\nThis outputs the completion script for the specified shell.\n\n### Installation\n\nUsers install completion by adding to their shell RC:\n\n**Bash** (~/.bashrc):\n```bash\neval \"$(asb completion bash)\"\n```\n\n**Zsh** (~/.zshrc):\n```bash\neval \"$(asb completion zsh)\"\n```\n\n**Fish** (~/.config/fish/config.fish):\n```bash\nasb completion fish | source\n```\n\n### Bash Completion Script\n\n```bash\n_asb_completions() {\n    local cur=\"${COMP_WORDS[COMP_CWORD]}\"\n    local prev=\"${COMP_WORDS[COMP_CWORD-1]}\"\n    \n    local commands=\"backup restore export import list history diff init config help version\"\n    local agents=\"aider amp claude cline codex cursor factory gemini opencode windsurf\"\n    local config_cmds=\"init show\"\n    \n    case \"$prev\" in\n        asb)\n            COMPREPLY=($(compgen -W \"$commands\" -- \"$cur\"))\n            ;;\n        backup|b|restore|r|history|h|diff|d|export|ex)\n            COMPREPLY=($(compgen -W \"$agents\" -- \"$cur\"))\n            ;;\n        config|cfg)\n            COMPREPLY=($(compgen -W \"$config_cmds\" -- \"$cur\"))\n            ;;\n        import|im)\n            # Complete tar.gz files\n            COMPREPLY=($(compgen -f -X '!*.tar.gz' -- \"$cur\"))\n            ;;\n        *)\n            # For restore command, complete commits\n            if [[ \"${COMP_WORDS[1]}\" == \"restore\" ]] && [[ $COMP_CWORD -eq 3 ]]; then\n                local agent=\"${COMP_WORDS[2]}\"\n                local backup_dir=\"$HOME/.agent_settings_backups/.${agent}\"\n                if [[ -d \"$backup_dir/.git\" ]]; then\n                    local commits\n                    commits=$(git -C \"$backup_dir\" log --oneline -10 2>/dev/null | cut -d' ' -f1)\n                    COMPREPLY=($(compgen -W \"$commits\" -- \"$cur\"))\n                fi\n            fi\n            ;;\n    esac\n}\n\ncomplete -F _asb_completions asb\n```\n\n## Implementation Notes\n\n### Keeping Agent List in Sync\n\nThe completion scripts hardcode the agent list. When a new agent is added:\n1. Add to AGENT_FOLDERS in asb\n2. Update completion scripts\n\nAlternatively, completion scripts could call `asb list --agents-only` dynamically,\nbut this adds latency to every tab press. Static list is better.\n\n### Dynamic Commit Completion\n\nFor `asb restore <agent> <TAB>`, we dynamically list recent commits.\nThis requires:\n- Knowing the backup directory path\n- Git access\n- Limiting to recent commits (10-20) for performance\n\n## Testing Checklist\n\n- [ ] Bash completion works\n- [ ] Zsh completion works  \n- [ ] Fish completion works\n- [ ] Commands complete correctly\n- [ ] Agent names complete correctly\n- [ ] File completion works for import\n- [ ] Commit completion works for restore\n- [ ] Completion installation instructions in help","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-19T21:26:21.785322398Z","created_by":"ubuntu","updated_at":"2026-01-20T04:01:00.585570089Z","closed_at":"2026-01-20T04:01:00.585446056Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-39b","depends_on_id":"bd-1lm","type":"blocks","created_at":"2026-01-19T21:29:31.582580519Z","created_by":"ubuntu"},{"issue_id":"bd-39b","depends_on_id":"bd-26s","type":"blocks","created_at":"2026-01-19T21:29:31.757914369Z","created_by":"ubuntu"},{"issue_id":"bd-39b","depends_on_id":"bd-3co","type":"blocks","created_at":"2026-01-19T21:29:31.919959949Z","created_by":"ubuntu"},{"issue_id":"bd-39b","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:26:21.803659376Z","created_by":"ubuntu"},{"issue_id":"bd-39b","depends_on_id":"bd-v3p","type":"blocks","created_at":"2026-01-19T21:29:32.081521498Z","created_by":"ubuntu"}]}
{"id":"bd-3av","title":"Completion: Implement fish completion script","description":"# Implement Fish Completion Script\n\n## Task\n\nCreate the fish completion script output by `asb completion fish`.\n\n## Implementation\n\nAdd show_completion_fish() function:\n\n```bash\nshow_completion_fish() {\n    cat << 'FISHCOMP'\n# asb fish completion\n# Install: asb completion fish | source\n# Or: asb completion fish > ~/.config/fish/completions/asb.fish\n\n# Disable file completion by default\ncomplete -c asb -f\n\n# Commands\ncomplete -c asb -n '__fish_use_subcommand' -a backup -d 'Backup agent settings'\ncomplete -c asb -n '__fish_use_subcommand' -a restore -d 'Restore agent from backup'\ncomplete -c asb -n '__fish_use_subcommand' -a export -d 'Export backup as archive'\ncomplete -c asb -n '__fish_use_subcommand' -a import -d 'Import backup from archive'\ncomplete -c asb -n '__fish_use_subcommand' -a list -d 'List all agents and status'\ncomplete -c asb -n '__fish_use_subcommand' -a history -d 'Show backup history'\ncomplete -c asb -n '__fish_use_subcommand' -a diff -d 'Show changes since last backup'\ncomplete -c asb -n '__fish_use_subcommand' -a init -d 'Initialize backup location'\ncomplete -c asb -n '__fish_use_subcommand' -a config -d 'Manage configuration'\ncomplete -c asb -n '__fish_use_subcommand' -a help -d 'Show help message'\ncomplete -c asb -n '__fish_use_subcommand' -a version -d 'Show version'\n\n# Global flags\ncomplete -c asb -s n -l dry-run -d 'Show what would happen without changes'\ncomplete -c asb -s f -l force -d 'Skip confirmation prompts'\ncomplete -c asb -s v -l verbose -d 'Show detailed output'\n\n# Agent names for commands that take them\nset -l agent_commands backup restore history diff export\n\nfor cmd in $agent_commands\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'aider' -d 'Aider'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'amp' -d 'Amp (Sourcegraph)'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'claude' -d 'Claude Code'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'cline' -d 'Cline'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'codex' -d 'OpenAI Codex CLI'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'cursor' -d 'Cursor'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'factory' -d 'Factory Droid'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'gemini' -d 'Google Gemini'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'opencode' -d 'OpenCode'\n    complete -c asb -n \"__fish_seen_subcommand_from $cmd\" -a 'windsurf' -d 'Windsurf'\nend\n\n# Config subcommands\ncomplete -c asb -n '__fish_seen_subcommand_from config' -a 'init' -d 'Create config file'\ncomplete -c asb -n '__fish_seen_subcommand_from config' -a 'show' -d 'Show settings'\n\n# File completion for import\ncomplete -c asb -n '__fish_seen_subcommand_from import' -F -a '*.tar.gz'\nFISHCOMP\n}\n```\n\n## Fish-Specific Features\n\n- Uses fish's complete command syntax\n- Condition functions (__fish_use_subcommand, __fish_seen_subcommand_from)\n- Proper description support\n- File globbing for import","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:27:16.987244362Z","created_by":"ubuntu","updated_at":"2026-01-20T04:28:57.964607416Z","closed_at":"2026-01-20T04:28:57.964527145Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3av","depends_on_id":"bd-39b","type":"parent-child","created_at":"2026-01-19T21:27:17.003964174Z","created_by":"ubuntu"}]}
{"id":"bd-3bc","title":"Config: Implement load_config function","description":"# Implement load_config Function\n\n## Task\n\nCreate a function that sources the config file if it exists, called early in main().\n\n## Implementation\n\n```bash\nload_config() {\n    local config_file\n    config_file=$(get_config_file)\n    \n    if [[ -f \"$config_file\" ]]; then\n        # Source the config file (it's bash)\n        # shellcheck source=/dev/null\n        source \"$config_file\"\n        log_debug \"Loaded config from $config_file\"\n    fi\n}\n```\n\n## Call Site\n\nIn main(), after the git check but before command parsing:\n\n```bash\nmain() {\n    # Check for git\n    if ! command_exists git; then\n        log_error \"git is required but not installed\"\n        exit 1\n    fi\n\n    # Load configuration  <-- ADD HERE\n    load_config\n\n    local command=\"${1:-help}\"\n    # ...\n}\n```\n\n## Precedence Behavior\n\nWhen load_config runs:\n1. Default values are already set (from script constants)\n2. Environment variables may already be set\n3. Config file is sourced, overwriting any variables it sets\n\nThis means config file values take precedence over env vars, which is the desired behavior.\nUsers who want env vars to win can simply not set those values in config file.\n\n## Error Handling\n\n- If config file has syntax errors, source will fail and script exits\n- This is intentional - config errors should be loud, not silent\n- Consider: add `bash -n \"$config_file\"` syntax check first for better error messages?","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:22:22.226303684Z","created_by":"ubuntu","updated_at":"2026-01-20T04:29:05.531314124Z","closed_at":"2026-01-20T04:29:05.531233282Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3bc","depends_on_id":"bd-1j1","type":"blocks","created_at":"2026-01-19T21:28:33.029265498Z","created_by":"ubuntu"},{"issue_id":"bd-3bc","depends_on_id":"bd-1lm","type":"parent-child","created_at":"2026-01-19T21:22:22.242692523Z","created_by":"ubuntu"}]}
{"id":"bd-3co","title":"Feature: Conflict Detection on Restore","description":"# Feature: Conflict Detection on Restore (CRITICAL SAFETY)\n\n## Problem Statement\n\nThis is the #1 safety issue in asb.\n\nCurrently, `asb restore claude` immediately overwrites ~/.claude with NO warning.\nIf the user:\n- Made changes since their last backup\n- Has an agent actively writing to config\n- Accidentally picked the wrong commit\n\n...they LOSE their current settings with NO RECOURSE.\n\nThis is unacceptable for a tool that manages user data.\n\n## Solution\n\nBefore restoring, show exactly what will change and require explicit confirmation.\n\n## Technical Design\n\n### User Flow\n\n```\n$ asb restore claude\n\nRestore Claude Code from backup?\n─────────────────────────────────\n\nBackup location: ~/.agent_settings_backups/.claude\nCommit: abc1234 (2 hours ago)\nMessage: Backup Claude Code: 2024-01-15 14:30:00 (3 files changed)\n\nThe following changes will be made to ~/.claude:\n  settings.json           differs (backup is 2 hours older)\n  projects/cache.json     only in current (will be DELETED)\n  themes/dark.json        identical\n\n⚠ WARNING: 1 file exists only in current config and will be deleted.\n\nProceed with restore? [y/N] _\n```\n\n### Implementation Components\n\n1. **show_restore_preview()** - Compares backup with current state\n2. **confirm_restore()** - Prompts for user confirmation\n3. **--force flag** - Skip confirmation for scripting\n\n### Diff Logic\n\n```bash\nshow_restore_preview() {\n    local backup_dir=\"$1\"\n    local current_dir=\"$2\"\n    local commit=\"$3\"\n    \n    # Extract backup state to temp dir\n    local temp_backup\n    temp_backup=$(mktemp -d)\n    trap \"rm -rf '$temp_backup'\" RETURN\n    \n    git -C \"$backup_dir\" archive \"$commit\" 2>/dev/null | \\\n        tar -C \"$temp_backup\" -xf - 2>/dev/null\n    \n    # Compare\n    printf '%b\\n' \"The following changes will be made to ${current_dir}:\"\n    \n    local only_in_current=0\n    local differs=0\n    \n    # Files that differ or only exist in one place\n    diff -rq \"$current_dir\" \"$temp_backup\" \\\n        --exclude='.git' \\\n        --exclude='.gitignore' \\\n        2>/dev/null | while read -r line; do\n        # Parse diff output...\n    done\n    \n    # Warn about deletions\n    if [[ $only_in_current -gt 0 ]]; then\n        printf '\\n'\n        printf '%b\\n' \"${YELLOW}⚠ WARNING: ${only_in_current} file(s) exist only in current config and will be deleted.${RESET}\"\n    fi\n}\n```\n\n### Force Flag\n\nFor scripted usage, add --force/-f to skip confirmation:\n\n```bash\nasb restore --force claude abc1234\n```\n\nThis is the ONLY way to restore without confirmation (besides piping yes).\n\n## Implementation Notes\n\n### Confirmation Behavior\n\n- Default is NO (pressing Enter without input = cancel)\n- Only 'y' or 'yes' (case-insensitive) proceeds\n- This is the safe default\n\n### Non-Interactive Detection\n\nIf stdin is not a TTY (piped or scripted):\n- Require --force flag\n- Without --force, error out with helpful message\n\n```bash\nif [[ ! -t 0 ]] && [[ \"$FORCE\" != \"true\" ]]; then\n    log_error \"Restore requires confirmation. Use --force for non-interactive mode.\"\n    exit 1\nfi\n```\n\n## Testing Checklist\n\n- [ ] Restore shows preview of changes\n- [ ] Files only in current are highlighted as \"will be deleted\"\n- [ ] User must type 'y' to proceed\n- [ ] Pressing Enter alone cancels\n- [ ] --force skips confirmation\n- [ ] Non-TTY without --force errors helpfully\n- [ ] Dry-run mode still works (shows preview, exits)","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-19T21:23:55.083296868Z","created_by":"ubuntu","updated_at":"2026-01-20T02:44:39.721958355Z","closed_at":"2026-01-20T02:44:39.721911587Z","close_reason":"Core implementation complete: show_restore_preview, confirm_restore, FORCE flag, and restore_agent updated with preview/confirmation flow","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3co","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:23:55.111065040Z","created_by":"ubuntu"}]}
{"id":"bd-3dt","title":"Completion: Implement bash completion script","description":"# Implement Bash Completion Script\n\n## Task\n\nCreate the bash completion script output by `asb completion bash`.\n\n## Implementation\n\nAdd show_completion_bash() function:\n\n```bash\nshow_completion_bash() {\n    cat << 'BASHCOMP'\n# asb bash completion\n# Install: eval \"$(asb completion bash)\"\n# Or: asb completion bash >> ~/.bashrc\n\n_asb_completions() {\n    local cur=\"${COMP_WORDS[COMP_CWORD]}\"\n    local prev=\"${COMP_WORDS[COMP_CWORD-1]}\"\n    local cmd=\"${COMP_WORDS[1]}\"\n    \n    # All commands\n    local commands=\"backup restore export import list history diff init config help version\"\n    \n    # All agent names (keep in sync with AGENT_FOLDERS)\n    local agents=\"aider amp claude cline codex cursor factory gemini opencode windsurf\"\n    \n    # Config subcommands\n    local config_cmds=\"init show\"\n    \n    # Global flags\n    local global_flags=\"-n --dry-run -f --force -v --verbose\"\n    \n    case \"$prev\" in\n        asb)\n            # Complete commands and global flags\n            COMPREPLY=($(compgen -W \"$commands $global_flags\" -- \"$cur\"))\n            ;;\n        -n|--dry-run|-f|--force|-v|--verbose)\n            # After a flag, complete commands\n            COMPREPLY=($(compgen -W \"$commands\" -- \"$cur\"))\n            ;;\n        backup|b)\n            # Complete agent names (can have multiple)\n            COMPREPLY=($(compgen -W \"$agents\" -- \"$cur\"))\n            ;;\n        restore|r|history|h|log|diff|d|export|ex)\n            # Complete agent names (single)\n            COMPREPLY=($(compgen -W \"$agents\" -- \"$cur\"))\n            ;;\n        config|cfg)\n            COMPREPLY=($(compgen -W \"$config_cmds\" -- \"$cur\"))\n            ;;\n        import|im)\n            # Complete .tar.gz files\n            COMPREPLY=($(compgen -f -X '!*.@(tar.gz|tgz)' -- \"$cur\"))\n            ;;\n        *)\n            # Check if we're completing commits for restore\n            if [[ \"$cmd\" == \"restore\" || \"$cmd\" == \"r\" ]] && [[ $COMP_CWORD -eq 3 ]]; then\n                local agent=\"${COMP_WORDS[2]}\"\n                local backup_dir=\"${HOME}/.agent_settings_backups/.${agent}\"\n                if [[ -d \"$backup_dir/.git\" ]]; then\n                    local commits\n                    commits=$(git -C \"$backup_dir\" log --oneline -15 2>/dev/null | cut -d' ' -f1)\n                    COMPREPLY=($(compgen -W \"$commits HEAD\" -- \"$cur\"))\n                fi\n            # Check if we're completing filename for export\n            elif [[ \"$cmd\" == \"export\" || \"$cmd\" == \"ex\" ]] && [[ $COMP_CWORD -eq 3 ]]; then\n                # Complete filenames\n                COMPREPLY=($(compgen -f -- \"$cur\"))\n            fi\n            ;;\n    esac\n}\n\ncomplete -F _asb_completions asb\nBASHCOMP\n}\n```\n\n## Features\n\n1. **Command completion**: All asb commands\n2. **Agent completion**: For backup, restore, history, diff, export\n3. **Config subcommand completion**: init, show\n4. **File completion**: For import (.tar.gz files)\n5. **Commit completion**: For restore (recent commits from git log)\n6. **Global flag completion**: -n, --dry-run, -f, --force, -v, --verbose\n\n## Keeping in Sync\n\nThe agent list is hardcoded for performance. When adding new agents:\n1. Update AGENT_FOLDERS in main script\n2. Update the `agents` variable in this completion script\n\nConsider adding a comment in AGENT_FOLDERS reminding to update completion.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:27:16.504241353Z","created_by":"ubuntu","updated_at":"2026-01-20T04:28:50.185072411Z","closed_at":"2026-01-20T04:28:50.184991970Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3dt","depends_on_id":"bd-39b","type":"parent-child","created_at":"2026-01-19T21:27:16.521521361Z","created_by":"ubuntu"}]}
{"id":"bd-3dw","title":"Conflict: Implement show_restore_preview function","description":"# Implement show_restore_preview Function\n\n## Task\n\nCreate a function that shows what will change if the user proceeds with restore.\n\n## Implementation\n\n```bash\nshow_restore_preview() {\n    local backup_dir=\"$1\"\n    local current_dir=\"$2\"\n    local commit=\"${3:-HEAD}\"\n    local agent_name=\"$4\"\n    \n    printf '\\n'\n    printf '%b\\n' \"${BOLD}Restore ${agent_name} from backup?${RESET}\"\n    printf '%s\\n' \"─────────────────────────────────────────\"\n    printf '\\n'\n    \n    # Show backup info\n    printf \"Backup location: %s\\n\" \"$backup_dir\"\n    \n    local commit_info\n    commit_info=$(git -C \"$backup_dir\" log -1 --format=\"%h (%ar)\" \"$commit\" 2>/dev/null)\n    printf \"Commit: %s\\n\" \"${commit_info:-$commit}\"\n    \n    local commit_msg\n    commit_msg=$(git -C \"$backup_dir\" log -1 --format=\"%s\" \"$commit\" 2>/dev/null)\n    printf \"Message: %s\\n\" \"${commit_msg:-unknown}\"\n    printf '\\n'\n    \n    # Extract backup to temp for comparison\n    local temp_backup\n    temp_backup=$(mktemp -d)\n    trap \"rm -rf '$temp_backup'\" RETURN\n    \n    if ! git -C \"$backup_dir\" archive \"$commit\" 2>/dev/null | tar -C \"$temp_backup\" -xf - 2>/dev/null; then\n        log_warn \"Could not extract backup for preview\"\n        return 1\n    fi\n    \n    # Check if current dir exists\n    if [[ ! -d \"$current_dir\" ]]; then\n        printf \"Target %s does not exist.\\n\" \"$current_dir\"\n        printf \"Will create directory with backup contents.\\n\"\n        return 0\n    fi\n    \n    # Compare and show differences\n    printf '%b\\n' \"${BOLD}Changes that will be made to ${current_dir}:${RESET}\"\n    printf '\\n'\n    \n    local only_in_current=0\n    local only_in_backup=0\n    local differs=0\n    \n    # Get diff output\n    local diff_output\n    diff_output=$(diff -rq \"$current_dir\" \"$temp_backup\" \\\n        --exclude='.git' \\\n        --exclude='.gitignore' \\\n        --exclude='*.log' \\\n        --exclude='cache' \\\n        --exclude='Cache' \\\n        --exclude='.cache' \\\n        2>/dev/null || true)\n    \n    if [[ -z \"$diff_output\" ]]; then\n        printf \"  ${DIM}(no differences detected)${RESET}\\n\"\n        return 0\n    fi\n    \n    # Parse and display differences\n    while IFS= read -r line; do\n        if [[ \"$line\" == *\"Only in $current_dir\"* ]]; then\n            local file=\"${line##*: }\"\n            printf \"  ${RED}%-40s${RESET} %s\\n\" \"$file\" \"(will be DELETED)\"\n            ((only_in_current++))\n        elif [[ \"$line\" == *\"Only in $temp_backup\"* ]]; then\n            local file=\"${line##*: }\"\n            printf \"  ${GREEN}%-40s${RESET} %s\\n\" \"$file\" \"(will be ADDED)\"\n            ((only_in_backup++))\n        elif [[ \"$line\" == *\" differ\"* ]]; then\n            # Extract filename from \"Files X and Y differ\"\n            local file=\"${line#Files $current_dir/}\"\n            file=\"${file%% and *}\"\n            printf \"  ${YELLOW}%-40s${RESET} %s\\n\" \"$file\" \"(will be REPLACED)\"\n            ((differs++))\n        fi\n    done <<< \"$diff_output\"\n    \n    printf '\\n'\n    \n    # Summary and warnings\n    if [[ $only_in_current -gt 0 ]]; then\n        printf '%b\\n' \"${YELLOW}⚠ WARNING: ${only_in_current} file(s) exist only in current config and will be DELETED.${RESET}\"\n    fi\n    \n    printf '\\n'\n    return 0\n}\n```\n\n## Output Colors\n\n- RED: Files that will be deleted (only in current)\n- GREEN: Files that will be added (only in backup)\n- YELLOW: Files that will be replaced (differ)\n\n## Error Handling\n\nIf git archive fails (bad commit), function returns 1 and restore should abort.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T21:24:47.119677354Z","created_by":"ubuntu","updated_at":"2026-01-20T02:43:14.608034918Z","closed_at":"2026-01-20T02:43:14.607993470Z","close_reason":"show_restore_preview function implemented with color-coded diff output","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3dw","depends_on_id":"bd-3co","type":"parent-child","created_at":"2026-01-19T21:24:47.130252663Z","created_by":"ubuntu"}]}
{"id":"bd-3hq","title":"Unit Test: Dry-Run Mode tests","description":"# Unit Test: Dry-Run Mode\n\n## Purpose\nCreate an automated test script (tests/test_dryrun.sh) that verifies dry-run mode makes NO changes.\n\n## Test Script Requirements\n\n### Setup/Teardown\n- Create isolated test directories with known state\n- Track filesystem state before/after each test\n- Support --verbose flag for detailed logging\n\n### Test Cases\n\n1. **test_dryrun_backup_no_file_changes**\n   - Create source directory with test files\n   - Run `asb --dry-run backup agent`\n   - Verify NO files created/modified in backup dir\n   - Verify timestamp of backup dir unchanged\n\n2. **test_dryrun_backup_no_git_commits**\n   - Setup backup repo with known commit count\n   - Run `asb --dry-run backup agent`\n   - Verify commit count unchanged\n   - Verify `git status` shows no changes\n\n3. **test_dryrun_backup_shows_preview**\n   - Run `asb --dry-run backup agent`\n   - Capture output\n   - Verify output contains file listing\n   - Verify output indicates dry-run mode\n\n4. **test_dryrun_short_flag**\n   - Run `asb -n backup agent`\n   - Verify same behavior as --dry-run\n\n5. **test_dryrun_restore_no_changes**\n   - Setup backup with known files\n   - Setup source dir with different files\n   - Run `asb --dry-run restore agent`\n   - Verify source dir UNCHANGED\n   - Verify output shows what WOULD change\n\n6. **test_dryrun_all_agents**\n   - Run `asb --dry-run backup`\n   - Verify NO changes to any backup dir\n   - Verify all agents shown in preview\n\n7. **test_dryrun_output_format**\n   - Run various dry-run commands\n   - Verify \"[DRY-RUN]\" prefix in output\n   - Verify colorized output when TTY\n\n## Filesystem Verification\n- Use md5sum/sha256sum of directories before/after\n- Track inode modification times\n- Compare git rev-parse HEAD before/after\n\n## Logging Requirements\n- Each test logs: START, PASS/FAIL, duration\n- Show filesystem state diffs on failure\n- Summary at end with timing info","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:39:01.129396121Z","created_by":"ubuntu","updated_at":"2026-01-20T04:07:46.680187124Z","closed_at":"2026-01-20T04:07:46.680108846Z","close_reason":"done","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3hq","depends_on_id":"bd-26s","type":"blocks","created_at":"2026-01-19T21:41:23.419577342Z","created_by":"ubuntu"},{"issue_id":"bd-3hq","depends_on_id":"bd-3ig","type":"blocks","created_at":"2026-01-19T21:41:23.212910482Z","created_by":"ubuntu"}]}
{"id":"bd-3ig","title":"Test Infrastructure: Create test framework and utilities","description":"# Test Infrastructure: Framework and Utilities\n\n## Purpose\nCreate the test infrastructure (tests/lib/) that all test scripts will use.\n\n## Directory Structure\n\\`\\`\\`\ntests/\n├── run_all.sh           # Master test runner\n├── lib/\n│   ├── test_utils.sh    # Environment setup, helpers\n│   ├── logging.sh       # Logging framework\n│   ├── assertions.sh    # Test assertions\n│   └── fixtures.sh      # Fixture management\n└── fixtures/\n    ├── sample_claude/   # Mock ~/.claude directory\n    ├── sample_cursor/   # Mock ~/.cursor directory\n    └── sample_codex/    # Mock ~/.codex directory\n\\`\\`\\`\n\n## lib/test_utils.sh\n\\`\\`\\`bash\n# Environment isolation\nsetup_test_env()      # Create isolated HOME, XDG dirs\nteardown_test_env()   # Clean up test environment\ncreate_mock_agent()   # Create mock agent config dir\n\n# Test execution\nrun_test()            # Run single test with logging\nskip_if_missing()     # Skip test if dependency missing\n\n# Helpers\nget_test_tmp_dir()    # Get temp dir for current test\npreserve_artifacts()  # Save artifacts on failure\n\\`\\`\\`\n\n## lib/logging.sh\n\\`\\`\\`bash\n# Log levels\nLOG_DEBUG=0\nLOG_INFO=1\nLOG_WARN=2\nLOG_ERROR=3\n\n# Functions\nlog_debug()           # Debug message\nlog_info()            # Info message\nlog_warn()            # Warning message\nlog_error()           # Error message (with stack trace)\nlog_section()         # Section header\n\n# Configuration\nLOG_LEVEL=${LOG_LEVEL:-$LOG_INFO}\nLOG_FILE=${LOG_FILE:-}\nLOG_COLOR=${LOG_COLOR:-auto}\n\n# Output format\n# [2026-01-19 15:30:00.123] [INFO ] [test_name] Message\n\\`\\`\\`\n\n## lib/assertions.sh\n\\`\\`\\`bash\nassert_equals()       # Assert two values equal\nassert_not_equals()   # Assert two values different\nassert_contains()     # Assert string contains substring\nassert_file_exists()  # Assert file exists\nassert_file_not_exists()  # Assert file doesn't exist\nassert_dir_exists()   # Assert directory exists\nassert_exit_code()    # Assert command exit code\nassert_output_contains()  # Assert command output contains\nassert_output_matches()   # Assert output matches regex\nassert_files_identical()  # Compare two files\nassert_dir_unchanged()    # Dir hasn't changed (by checksum)\n\\`\\`\\`\n\n## lib/fixtures.sh\n\\`\\`\\`bash\n# Fixture creation\ncreate_claude_fixture()   # Create mock ~/.claude\ncreate_cursor_fixture()   # Create mock ~/.cursor\ncreate_codex_fixture()    # Create mock ~/.codex\n\n# Fixture content\n# Each fixture includes:\n#   - config.json\n#   - settings.json\n#   - projects/ directory\n#   - extensions/ directory\n#   - Random realistic content\n\\`\\`\\`\n\n## run_all.sh\n\\`\\`\\`bash\n#!/usr/bin/env bash\n# Master test runner\n\n# Options\n#   --verbose, -v    Enable debug logging\n#   --filter PATTERN Run only matching tests\n#   --parallel N     Run N tests in parallel\n#   --keep-artifacts Keep artifacts on success too\n\n# Exit codes\n#   0 - All tests passed\n#   1 - Some tests failed\n#   2 - Test infrastructure error\n\\`\\`\\`\n\n## Requirements\n- bash 4.0+ (for associative arrays)\n- Standard Unix tools (diff, md5sum/shasum)\n- git (for backup testing)\n- Optional: parallel, script (for advanced tests)\n\n## Success Criteria\n- All utility functions work correctly\n- Logging produces readable, timestamp output\n- Assertions fail loudly with helpful messages\n- Fixtures are realistic and reusable","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T21:40:36.475575487Z","created_by":"ubuntu","updated_at":"2026-01-20T03:56:31.486890207Z","closed_at":"2026-01-20T03:56:31.486827519Z","close_reason":"Implemented tests/ framework (logging/assertions/test_utils), fixtures templates, and fixture-backed mock creation","compaction_level":0,"original_size":0}
{"id":"bd-3jx","title":"Export: Implement import_backup function","description":"# Implement import_backup Function\n\n## Task\n\nCreate the import_backup() function that restores an archive.\n\n## Implementation\n\n```bash\nimport_backup() {\n    local archive=\"$1\"\n    local backup_root\n    backup_root=$(get_backup_root)\n    \n    # Validate archive\n    if [[ \"$archive\" != \"-\" ]]; then\n        if [[ ! -f \"$archive\" ]]; then\n            log_error \"Archive not found: ${archive}\"\n            return 1\n        fi\n    fi\n    \n    # Dry-run mode\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        log_info \"[DRY RUN] Would import from ${archive}\"\n        log_info \"[DRY RUN] Destination: ${backup_root}\"\n        \n        if [[ \"$archive\" != \"-\" ]]; then\n            # Show archive contents\n            log_info \"[DRY RUN] Archive contents:\"\n            tar -tzf \"$archive\" 2>/dev/null | head -10\n        fi\n        return 0\n    fi\n    \n    log_step \"Importing backup...\"\n    \n    # Create backup location if needed\n    mkdir -p \"$backup_root\"\n    \n    # Peek at archive to see what agent it contains\n    local agent_folder=\"\"\n    if [[ \"$archive\" != \"-\" ]]; then\n        agent_folder=$(tar -tzf \"$archive\" 2>/dev/null | head -1 | cut -d'/' -f1)\n    fi\n    \n    # Check for existing backup (conflict detection)\n    if [[ -n \"$agent_folder\" ]] && [[ -d \"$backup_root/$agent_folder\" ]]; then\n        if [[ \"$FORCE\" != \"true\" ]]; then\n            log_warn \"Backup already exists: $backup_root/$agent_folder\"\n            \n            if [[ -t 0 ]]; then\n                printf 'Overwrite existing backup? [y/N] '\n                local response\n                IFS= read -r response\n                case \"$response\" in\n                    [yY]|[yY][eE][sS])\n                        log_info \"Will overwrite existing backup\"\n                        ;;\n                    *)\n                        log_info \"Import cancelled\"\n                        return 1\n                        ;;\n                esac\n            else\n                log_error \"Use --force to overwrite existing backup\"\n                return 1\n            fi\n        fi\n        \n        # Remove existing before extract\n        rm -rf \"$backup_root/$agent_folder\"\n    fi\n    \n    # Extract archive\n    if [[ \"$archive\" == \"-\" ]]; then\n        tar -xzf - -C \"$backup_root\" 2>/dev/null\n    else\n        tar -xzf \"$archive\" -C \"$backup_root\" 2>/dev/null\n    fi\n    \n    if [[ $? -ne 0 ]]; then\n        log_error \"Failed to extract archive\"\n        return 1\n    fi\n    \n    log_success \"Imported backup\"\n    log_info \"Destination: ${backup_root}\"\n    log_info \"Run 'asb list' to see imported backups\"\n    \n    return 0\n}\n```\n\n## Conflict Handling\n\nIf the agent already has a backup:\n1. Warn user\n2. In interactive mode: prompt for confirmation\n3. In non-interactive mode: require --force\n4. Never silently overwrite\n\n## Stdin Mode\n\nWhen archive is \"-\", tar reads from stdin:\n- Enables piping: `ssh remote \"asb export claude -\" | asb import -`\n- Cannot peek at contents for conflict detection\n- Trust that user knows what they're doing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:25:57.331083481Z","created_by":"ubuntu","updated_at":"2026-01-20T04:29:03.017575877Z","closed_at":"2026-01-20T04:29:03.017427147Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3jx","depends_on_id":"bd-v3p","type":"parent-child","created_at":"2026-01-19T21:25:57.342613478Z","created_by":"ubuntu"}]}
{"id":"bd-3sg","title":"E2E Test Suite: Complete workflow tests with logging","description":"# E2E Test Suite: Complete Workflow Tests\n\n## Purpose\nCreate a comprehensive end-to-end test script (tests/test_e2e.sh) that tests full workflows across all features with detailed logging.\n\n## Test Script Requirements\n\n### Architecture\n\\`\\`\\`\ntests/\n├── test_e2e.sh          # Main E2E runner\n├── lib/\n│   ├── test_utils.sh    # Common test utilities\n│   ├── logging.sh       # Logging framework\n│   └── assertions.sh    # Test assertions\n└── fixtures/\n    ├── sample_config/   # Sample agent config files\n    └── test_data/       # Test data files\n\\`\\`\\`\n\n### Logging Framework (lib/logging.sh)\n\\`\\`\\`bash\n# Logging levels: DEBUG, INFO, WARN, ERROR\n# Format: [TIMESTAMP] [LEVEL] [TEST_NAME] Message\n# Features:\n#   - Log to file and optionally stdout\n#   - Colorized output for TTY\n#   - Duration tracking per test\n#   - Stack traces on errors\n#   - Artifact preservation on failure\n\\`\\`\\`\n\n### E2E Workflow Tests\n\n1. **test_fresh_install_workflow**\n   - Start with no asb installed\n   - Run install.sh\n   - Verify asb in PATH\n   - Run `asb --version`\n   - Run `asb config init`\n   - Verify config file created\n\n2. **test_first_backup_workflow**\n   - Create mock agent config directory\n   - Run `asb backup agent`\n   - Verify backup created\n   - Verify git history started\n   - Run `asb list`\n   - Verify agent shows as backed up\n\n3. **test_modify_and_backup_workflow**\n   - Make changes to agent config\n   - Run `asb backup agent`\n   - Verify new commit created\n   - Run `asb log agent`\n   - Verify commit message correct\n   - Run `asb diff agent`\n   - Verify shows no diff (just backed up)\n\n4. **test_restore_workflow**\n   - Make changes to agent config\n   - Run `asb restore agent` (answer 'y')\n   - Verify changes reverted\n   - Verify files match backup\n\n5. **test_export_import_workflow**\n   - Run `asb export agent`\n   - Delete backup directory\n   - Run `asb import archive.tar.gz`\n   - Run `asb log agent`\n   - Verify full history preserved\n\n6. **test_multi_agent_workflow**\n   - Create multiple mock agents (claude, cursor, codex)\n   - Run `asb backup` (all)\n   - Modify each agent\n   - Run `asb backup` again\n   - Run `asb list`\n   - Verify all show correct status\n\n7. **test_dryrun_safety_workflow**\n   - Run `asb --dry-run backup`\n   - Verify no changes\n   - Run `asb --dry-run restore agent`\n   - Verify preview shown, no changes\n   - Run actual backup\n   - Verify now changes made\n\n8. **test_disaster_recovery_workflow**\n   - Setup full environment\n   - Export all agents\n   - \"Disaster\": delete all backups\n   - Import each archive\n   - Verify full restoration\n\n9. **test_concurrent_sessions**\n   - Start backup in background\n   - Start another backup\n   - Verify locking works\n   - Verify no corruption\n\n10. **test_large_files_workflow**\n    - Create agent config with large files (10MB+)\n    - Backup, modify, backup again\n    - Verify performance acceptable\n    - Verify git handles large files\n\n### Detailed Logging Example\n\\`\\`\\`\n[2026-01-19 15:30:00] [INFO] [test_fresh_install_workflow] Starting test\n[2026-01-19 15:30:00] [DEBUG] [test_fresh_install_workflow] Creating temp directory: /tmp/asb-test-xyz\n[2026-01-19 15:30:01] [INFO] [test_fresh_install_workflow] Running install.sh\n[2026-01-19 15:30:02] [DEBUG] [test_fresh_install_workflow] Install output: asb installed to /usr/local/bin\n[2026-01-19 15:30:02] [INFO] [test_fresh_install_workflow] Verifying installation\n[2026-01-19 15:30:02] [DEBUG] [test_fresh_install_workflow] asb --version: asb 0.2.0\n[2026-01-19 15:30:02] [INFO] [test_fresh_install_workflow] PASSED (2.1s)\n\\`\\`\\`\n\n### Test Environment\n- Isolated HOME directory per test\n- Mock XDG directories\n- Capture all stdout/stderr\n- Preserve artifacts on failure\n\n### Summary Output\n\\`\\`\\`\n====================================\nE2E Test Suite Results\n====================================\nTotal:    10\nPassed:   9\nFailed:   1\nSkipped:  0\nDuration: 45.2s\n====================================\n\nFailed Tests:\n  - test_concurrent_sessions: Lock not acquired (see logs/test_concurrent_sessions.log)\n\nArtifacts preserved in: /tmp/asb-e2e-failure-xyz/\n\\`\\`\\`\n\n## Success Criteria\n- All E2E tests pass\n- No test takes more than 60s\n- Logs are comprehensive and helpful\n- Failures are easy to diagnose","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T21:40:16.836525322Z","created_by":"ubuntu","updated_at":"2026-01-20T04:19:46.306803033Z","closed_at":"2026-01-20T04:19:46.306756075Z","close_reason":"Implemented comprehensive E2E test suite with 10 workflow tests covering backup, restore, export/import, multi-agent, dry-run, disaster recovery, config, completion, and version/help workflows. All tests pass.","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3sg","depends_on_id":"bd-34i","type":"blocks","created_at":"2026-01-19T21:41:41.765051692Z","created_by":"ubuntu"},{"issue_id":"bd-3sg","depends_on_id":"bd-3hq","type":"blocks","created_at":"2026-01-19T21:41:41.223019418Z","created_by":"ubuntu"},{"issue_id":"bd-3sg","depends_on_id":"bd-3ig","type":"blocks","created_at":"2026-01-19T21:41:40.842917951Z","created_by":"ubuntu"},{"issue_id":"bd-3sg","depends_on_id":"bd-9rp","type":"blocks","created_at":"2026-01-19T21:41:41.039374990Z","created_by":"ubuntu"},{"issue_id":"bd-3sg","depends_on_id":"bd-k47","type":"blocks","created_at":"2026-01-19T21:41:41.575944999Z","created_by":"ubuntu"},{"issue_id":"bd-3sg","depends_on_id":"bd-shi","type":"blocks","created_at":"2026-01-19T21:41:41.395695345Z","created_by":"ubuntu"}]}
{"id":"bd-3u9","title":"asb v0.2: Five Core Improvements Epic","description":"# asb v0.2: Five Core Improvements\n\n## Overview\n\nThis epic tracks implementation of five high-value improvements to asb (Agent Settings Backup)\nthat will transform it from a functional script into a polished, professional CLI tool.\n\n## Background & Rationale\n\nAfter careful analysis of 30 potential improvements, these five were selected based on:\n- **Value**: Each addresses real user pain points\n- **Risk**: All carry minimal implementation risk  \n- **Effort**: Reasonable to implement correctly\n- **Universality**: Benefits all users, not just power users\n\n## The Five Improvements (Priority Order)\n\n1. **Conflict Detection on Restore** - Prevents data loss on restore\n2. **Dry-Run Mode** - Builds trust, enables safe exploration\n3. **Shell Completion** - Professional UX, discoverability\n4. **Configuration File** - Persistent, discoverable settings\n5. **Import/Export Archives** - Portability between machines\n\n## Implementation Order\n\nRecommended order considering dependencies:\n1. Configuration file (foundational - other features may use settings)\n2. Dry-run mode (standalone, simple, builds confidence)\n3. Conflict detection (standalone, critical safety)\n4. Import/export (adds new commands)\n5. Shell completion (LAST - needs to know all final commands)\n\n## Success Criteria\n\n- All five features implemented and tested\n- README updated with new features\n- AGENTS.md updated with new functions/patterns\n- VERSION bumped to 0.2.0\n- No regressions in existing functionality","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-19T21:21:18.244580059Z","created_by":"ubuntu","updated_at":"2026-01-20T04:14:04.042666793Z","closed_at":"2026-01-20T04:14:04.042625575Z","close_reason":"All five core features implemented and tested: Conflict Detection, Dry-Run Mode, Shell Completion, Config File Support, Import/Export Archives","compaction_level":0,"original_size":0}
{"id":"bd-6ic","title":"Completion: Register completion command in main()","description":"# Register completion Command\n\n## Task\n\nAdd the completion subcommand to main() that outputs shell completion scripts.\n\n## Implementation\n\nAdd to the case statement in main():\n\n```bash\ncompletion)\n    local shell=\"${1:-bash}\"\n    case \"$shell\" in\n        bash)\n            show_completion_bash\n            ;;\n        zsh)\n            show_completion_zsh\n            ;;\n        fish)\n            show_completion_fish\n            ;;\n        *)\n            log_error \"Unknown shell: ${shell}\"\n            log_info \"Supported: bash, zsh, fish\"\n            exit 1\n            ;;\n    esac\n    ;;\n```\n\n## Usage\n\n```bash\n# Output bash completion\nasb completion bash\n\n# Output zsh completion\nasb completion zsh\n\n# Output fish completion\nasb completion fish\n\n# Default is bash\nasb completion\n```\n\n## No Alias\n\nUnlike other commands (backup/b, restore/r), completion doesn't need a short alias.\nIt's a one-time setup command, not used frequently.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:27:17.233305750Z","created_by":"ubuntu","updated_at":"2026-01-20T04:28:47.040954585Z","closed_at":"2026-01-20T04:28:47.040873141Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-6ic","depends_on_id":"bd-22s","type":"blocks","created_at":"2026-01-19T21:29:18.027712073Z","created_by":"ubuntu"},{"issue_id":"bd-6ic","depends_on_id":"bd-39b","type":"parent-child","created_at":"2026-01-19T21:27:17.249358506Z","created_by":"ubuntu"},{"issue_id":"bd-6ic","depends_on_id":"bd-3av","type":"blocks","created_at":"2026-01-19T21:29:18.179664593Z","created_by":"ubuntu"},{"issue_id":"bd-6ic","depends_on_id":"bd-3dt","type":"blocks","created_at":"2026-01-19T21:29:17.854233337Z","created_by":"ubuntu"}]}
{"id":"bd-9rp","title":"Unit Test: Configuration File Support tests","description":"# Unit Test: Configuration File Support\n\n## Purpose\nCreate an automated test script (tests/test_config.sh) that verifies all configuration file functionality.\n\n## Test Script Requirements\n\n### Setup/Teardown\n- Create isolated test environment with custom XDG_CONFIG_HOME\n- Clean up test artifacts after each test\n- Support --verbose flag for detailed logging\n\n### Test Cases\n\n1. **test_config_init_creates_file**\n   - Run `asb config init`\n   - Verify file created at expected location\n   - Verify file has valid YAML structure\n   - Verify default values present\n\n2. **test_config_init_idempotent**\n   - Create config with custom value\n   - Run `asb config init` again\n   - Verify original file NOT overwritten\n\n3. **test_config_show_displays_all**\n   - Create config with known values\n   - Run `asb config show`\n   - Verify all settings displayed\n\n4. **test_config_precedence**\n   - Set value in config file\n   - Set same value via env var\n   - Verify config file wins\n\n5. **test_missing_config_graceful**\n   - Ensure no config file exists\n   - Run `asb backup --dry-run`\n   - Verify no errors, defaults used\n\n6. **test_xdg_config_home_respected**\n   - Set custom XDG_CONFIG_HOME\n   - Run `asb config init`\n   - Verify file in custom location\n\n7. **test_malformed_config_error**\n   - Create invalid YAML config\n   - Run `asb config show`\n   - Verify helpful error message\n\n## Logging Requirements\n- Each test logs: START, PASS/FAIL, duration\n- Failed tests show expected vs actual\n- Summary at end: passed/failed/total\n- Exit code reflects test results","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:38:47.031972122Z","created_by":"ubuntu","updated_at":"2026-01-20T04:07:46.651708777Z","closed_at":"2026-01-20T04:07:46.651651599Z","close_reason":"done","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-9rp","depends_on_id":"bd-1lm","type":"blocks","created_at":"2026-01-19T21:41:21.913064550Z","created_by":"ubuntu"},{"issue_id":"bd-9rp","depends_on_id":"bd-3ig","type":"blocks","created_at":"2026-01-19T21:41:21.701057366Z","created_by":"ubuntu"}]}
{"id":"bd-g6l","title":"Dry-run: Add dry-run support to restore command","description":"# Add Dry-Run Support to Restore\n\n## Task\n\nAdd dry-run handling to restore_agent() function.\n\n## Implementation\n\nIn restore_agent(), add dry-run handling after validation:\n\n```bash\nrestore_agent() {\n    local agent=\"$1\"\n    local commit=\"${2:-HEAD}\"\n    local source\n    local dest\n    local agent_name=\"${AGENT_NAMES[$agent]:-$agent}\"\n\n    source=$(get_agent_backup_dir \"$agent\")\n    dest=$(get_agent_source \"$agent\")\n\n    if [[ ! -d \"$source/.git\" ]]; then\n        log_error \"No backup found for ${agent_name}\"\n        return 1\n    fi\n\n    # === DRY RUN MODE ===\n    if [[ \"$DRY_RUN\" == \"true\" ]]; then\n        log_info \"${DIM}[DRY RUN]${RESET} Would restore ${agent_name}\"\n        log_info \"${DIM}[DRY RUN]${RESET} From: ${source}\"\n        log_info \"${DIM}[DRY RUN]${RESET} To: ${dest}\"\n        log_info \"${DIM}[DRY RUN]${RESET} Commit: ${commit}\"\n        \n        # Show what would change\n        if [[ -d \"$dest\" ]]; then\n            log_info \"${DIM}[DRY RUN]${RESET} Changes that would be applied:\"\n            # Create temp with backup state for comparison\n            local temp_backup\n            temp_backup=$(mktemp -d)\n            trap \"rm -rf '$temp_backup'\" RETURN\n            git -C \"$source\" archive \"$commit\" 2>/dev/null | tar -C \"$temp_backup\" -xf - 2>/dev/null\n            \n            diff -rq \"$dest\" \"$temp_backup\" \\\n                --exclude='.git' \\\n                --exclude='.gitignore' \\\n                2>/dev/null | head -20 || log_info \"  (no differences or comparison unavailable)\"\n        else\n            log_info \"${DIM}[DRY RUN]${RESET} Would create ${dest} with backup contents\"\n        fi\n        \n        return 0\n    fi\n    # === END DRY RUN MODE ===\n\n    # ... rest of existing implementation ...\n}\n```\n\n## Why This Matters\n\nRestore is even MORE important to preview than backup:\n- Restore overwrites current settings\n- Wrong commit selection could lose recent changes\n- Dry-run lets user verify they're restoring the right thing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:23:30.240620781Z","created_by":"ubuntu","updated_at":"2026-01-20T04:29:23.299100084Z","closed_at":"2026-01-20T04:29:23.299019573Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-g6l","depends_on_id":"bd-26s","type":"parent-child","created_at":"2026-01-19T21:23:30.256884094Z","created_by":"ubuntu"},{"issue_id":"bd-g6l","depends_on_id":"bd-2lk","type":"blocks","created_at":"2026-01-19T21:28:45.285629690Z","created_by":"ubuntu"}]}
{"id":"bd-k47","title":"Unit Test: Import/Export Archive tests","description":"# Unit Test: Import/Export Archives\n\n## Purpose\nCreate an automated test script (tests/test_export.sh) that verifies archive creation and restoration.\n\n## Test Script Requirements\n\n### Setup/Teardown\n- Create isolated backup directories with git history\n- Clean up archive files after tests\n- Support --verbose flag for detailed logging\n\n### Test Cases\n\n1. **test_export_creates_archive**\n   - Setup backup with git history\n   - Run `asb export agent`\n   - Verify .tar.gz file created\n   - Verify filename is timestamped\n\n2. **test_export_custom_filename**\n   - Run `asb export agent custom.tar.gz`\n   - Verify custom.tar.gz created\n   - Verify no timestamped file created\n\n3. **test_export_includes_git**\n   - Export backup\n   - Extract archive to temp dir\n   - Verify .git directory exists\n   - Verify `git log` shows history\n\n4. **test_export_to_stdout**\n   - Run `asb export agent -`\n   - Pipe to tar -tzf -\n   - Verify valid tar output\n   - Verify contains expected files\n\n5. **test_import_restores_backup**\n   - Export a backup\n   - Delete original backup dir\n   - Run `asb import archive.tar.gz`\n   - Verify backup dir restored\n   - Verify git history intact\n\n6. **test_import_detects_existing**\n   - Export backup\n   - Run `asb import archive.tar.gz` (without deleting)\n   - Verify prompt about existing backup\n   - Verify stdin='n' cancels\n\n7. **test_import_force_overwrites**\n   - Setup existing backup\n   - Create archive with different content\n   - Run `asb --force import archive.tar.gz`\n   - Verify overwritten without prompt\n\n8. **test_export_dryrun**\n   - Run `asb --dry-run export agent`\n   - Verify NO archive created\n   - Verify output shows what WOULD be created\n\n9. **test_import_invalid_archive**\n   - Create invalid tar file\n   - Run `asb import invalid.tar.gz`\n   - Verify helpful error message\n   - Verify exit code non-zero\n\n10. **test_export_nonexistent_agent**\n    - Run `asb export nonexistent`\n    - Verify helpful error message\n    - Verify lists valid agents\n\n## Archive Verification\n- Use tar -tzf to list contents\n- Verify .git/objects directory present\n- Check file permissions preserved\n\n## Logging Requirements\n- Each test logs: START, PASS/FAIL, duration\n- Log archive contents on verification\n- Show size of archive created","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:39:31.836255005Z","created_by":"ubuntu","updated_at":"2026-01-20T04:33:21.414343903Z","closed_at":"2026-01-20T04:33:21.414263222Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-k47","depends_on_id":"bd-3ig","type":"blocks","created_at":"2026-01-19T21:41:26.482449288Z","created_by":"ubuntu"},{"issue_id":"bd-k47","depends_on_id":"bd-v3p","type":"blocks","created_at":"2026-01-19T21:41:26.693568016Z","created_by":"ubuntu"}]}
{"id":"bd-m0f","title":"Release: Bump version to 0.2.0","description":"# Bump Version to 0.2.0\n\n## Task\n\nUpdate version numbers in preparation for v0.2.0 release.\n\n## Files to Update\n\n### VERSION file\n```\n0.2.0\n```\n\n### asb script (ASB_VERSION constant)\n```bash\nASB_VERSION=\"0.2.0\"\n```\n\n## Verification\n\nAfter updating, verify:\n```bash\n./asb version\n# Should output: asb version 0.2.0\n\ncat VERSION\n# Should output: 0.2.0\n```\n\n## When to Do This\n\nThis should be the LAST task before the release.\nAll features must be complete and tested.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-19T21:27:57.064465004Z","created_by":"ubuntu","updated_at":"2026-01-19T21:29:45.190375335Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-m0f","depends_on_id":"bd-1gy","type":"blocks","created_at":"2026-01-19T21:29:45.190358493Z","created_by":"ubuntu"},{"issue_id":"bd-m0f","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:27:57.082145245Z","created_by":"ubuntu"}]}
{"id":"bd-shi","title":"Unit Test: Conflict Detection tests","description":"# Unit Test: Conflict Detection on Restore\n\n## Purpose\nCreate an automated test script (tests/test_conflict.sh) that verifies restore safety and conflict detection.\n\n## Test Script Requirements\n\n### Setup/Teardown\n- Create isolated test directories\n- Mock TTY/non-TTY environments\n- Support --verbose flag for detailed logging\n\n### Test Cases\n\n1. **test_restore_shows_preview**\n   - Create backup with files A, B, C\n   - Create source with files A (modified), D\n   - Run `asb restore agent` (capture output)\n   - Verify preview shows:\n     - A: will be overwritten\n     - B, C: will be added\n     - D: will be DELETED (critical!)\n\n2. **test_restore_requires_confirmation**\n   - Setup scenario with changes\n   - Run `asb restore agent` with stdin='n'\n   - Verify restore CANCELLED\n   - Verify source dir UNCHANGED\n\n3. **test_restore_confirm_yes**\n   - Setup scenario with changes\n   - Run `asb restore agent` with stdin='y'\n   - Verify restore COMPLETED\n   - Verify files match backup\n\n4. **test_restore_enter_cancels**\n   - Run `asb restore agent` with stdin='' (just Enter)\n   - Verify restore CANCELLED\n   - Verify source dir UNCHANGED\n\n5. **test_force_skips_confirmation**\n   - Setup scenario\n   - Run `asb --force restore agent` (no stdin)\n   - Verify restore COMPLETED immediately\n\n6. **test_non_tty_without_force_error**\n   - Run `asb restore agent </dev/null`\n   - Verify helpful error message\n   - Verify suggests --force flag\n   - Verify exit code non-zero\n\n7. **test_preview_formatting**\n   - Test with many files\n   - Verify colors (+ green, - red, ~ yellow)\n   - Verify sorted output\n   - Verify file counts in summary\n\n8. **test_no_changes_scenario**\n   - Setup source identical to backup\n   - Run `asb restore agent`\n   - Verify \"Already up to date\" message\n   - Verify no confirmation needed\n\n## TTY Mocking\nUse `script` command or pty tools to test TTY behavior:\n\\`\\`\\`bash\n# Force TTY\nscript -q -c \"asb restore agent\" /dev/null <<< \"y\"\n# Force non-TTY\nasb restore agent </dev/null\n\\`\\`\\`\n\n## Logging Requirements\n- Each test logs: START, PASS/FAIL, duration\n- Log full command output on failure\n- Show file diffs on unexpected changes","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-19T21:39:15.543281663Z","created_by":"ubuntu","updated_at":"2026-01-20T04:00:08.071852502Z","closed_at":"2026-01-20T04:00:08.071794102Z","close_reason":"Added comprehensive tests/test_conflict.sh covering preview, confirmation paths, non-tty errors, formatting, and sorting","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-shi","depends_on_id":"bd-3co","type":"blocks","created_at":"2026-01-19T21:41:25.109468820Z","created_by":"ubuntu"},{"issue_id":"bd-shi","depends_on_id":"bd-3ig","type":"blocks","created_at":"2026-01-19T21:41:24.936577217Z","created_by":"ubuntu"}]}
{"id":"bd-sj6","title":"Documentation: Update AGENTS.md with new functions and patterns","description":"# Update AGENTS.md with New Functions and Patterns\n\n## Task\n\nUpdate the AI agent guidelines document with new functions, patterns, and considerations.\n\n## Sections to Update\n\n### Key Functions Table\nAdd new functions:\n| Function | Purpose |\n|----------|---------|\n| `load_config` | Sources config file at startup |\n| `init_config` | Creates default config file |\n| `show_config` | Displays effective configuration |\n| `show_restore_preview` | Shows diff before restore |\n| `confirm_restore` | Prompts for restore confirmation |\n| `export_backup` | Creates portable tar.gz archive |\n| `import_backup` | Restores archive to backup location |\n| `show_completion_bash` | Outputs bash completion script |\n| `show_completion_zsh` | Outputs zsh completion script |\n| `show_completion_fish` | Outputs fish completion script |\n\n### Add Global Flags Section\n```markdown\n## Global Flags\n\n| Flag | Variable | Description |\n|------|----------|-------------|\n| -n, --dry-run | DRY_RUN | Preview without changes |\n| -f, --force | FORCE | Skip confirmations |\n| -v, --verbose | ASB_VERBOSE | Debug output |\n\nFlags are parsed in main() before the command.\n```\n\n### Add Configuration Section\n```markdown\n## Configuration System\n\n### Loading Order\n1. Script constants (defaults)\n2. Config file sourced (if exists)\n3. Environment variables override\n\n### Config File Location\n`${XDG_CONFIG_HOME:-$HOME/.config}/asb/config`\n```\n\n### Update Test Scenarios\nAdd new test scenarios:\n- Dry-run backup shows preview\n- Restore shows confirmation prompt\n- --force skips confirmation\n- Config file is loaded at startup\n- Export creates valid archive\n- Import restores archive correctly\n- Completion scripts output correctly\n\n### Update Coding Standards\nAdd note about keeping completion scripts in sync with AGENT_FOLDERS.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-19T21:27:56.754125324Z","created_by":"ubuntu","updated_at":"2026-01-20T04:33:18.571533739Z","closed_at":"2026-01-20T04:33:18.571450702Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-sj6","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:27:56.773426569Z","created_by":"ubuntu"},{"issue_id":"bd-sj6","depends_on_id":"bd-zkw","type":"blocks","created_at":"2026-01-19T21:29:33.031844777Z","created_by":"ubuntu"}]}
{"id":"bd-v3p","title":"Feature: Import/Export Archives","description":"# Feature: Import/Export Archives\n\n## Problem Statement\n\nBackups that can't be moved are only half useful. Real-world scenarios where portability matters:\n\n1. **New machine setup**: User gets a new laptop, wants to bring agent configs\n2. **Sharing configs**: Team wants to share a known-good Claude setup\n3. **Disaster recovery**: User's home directory is corrupted, but they emailed an archive\n4. **Cross-platform**: User switches from Linux to Mac\n5. **Backup redundancy**: User wants to store backups in cloud storage\n\nWithout export/import, users must manually tar directories, figure out paths, and hope for the best.\n\n## Solution\n\nAdd two new commands:\n- `asb export <agent> [file]` - Creates portable tar.gz archive with full git history\n- `asb import <file>` - Restores archive to backup location\n\n## Technical Design\n\n### Export Command\n\n```bash\nasb export claude                    # Creates claude-backup-20240115.tar.gz\nasb export claude my-backup.tar.gz   # Creates my-backup.tar.gz\nasb export claude -                  # Writes to stdout (for piping)\n```\n\n### Import Command\n\n```bash\nasb import my-backup.tar.gz          # Imports to backup location\nasb import -                         # Reads from stdin (for piping)\n```\n\n### Archive Format\n\nThe archive is a standard tar.gz containing:\n```\n.claude/\n├── .git/           # Full git history preserved!\n├── .gitignore\n├── settings.json\n└── ...\n```\n\nThe directory name tells us which agent it is.\n\n### Implementation\n\n**export_backup()**\n```bash\nexport_backup() {\n    local agent=\"$1\"\n    local output=\"${2:-}\"\n    local agent_name=\"${AGENT_NAMES[$agent]:-$agent}\"\n    local source\n    source=$(get_agent_backup_dir \"$agent\")\n    \n    if [[ ! -d \"$source/.git\" ]]; then\n        log_error \"No backup found for ${agent_name}\"\n        return 1\n    fi\n    \n    # Generate default filename if not specified\n    if [[ -z \"$output\" ]]; then\n        output=\"${agent}-backup-$(date +%Y%m%d).tar.gz\"\n    fi\n    \n    log_step \"Exporting ${agent_name} to ${output}...\"\n    \n    # Create archive preserving git history\n    local backup_root\n    backup_root=$(get_backup_root)\n    local folder=\"${AGENT_FOLDERS[$agent]}\"\n    \n    if [[ \"$output\" == \"-\" ]]; then\n        # Write to stdout\n        tar -czf - -C \"$backup_root\" \"$folder\"\n    else\n        tar -czf \"$output\" -C \"$backup_root\" \"$folder\"\n        \n        local size\n        size=$(du -h \"$output\" | cut -f1)\n        log_success \"Exported ${agent_name} (${size})\"\n        log_info \"File: $(realpath \"$output\")\"\n    fi\n}\n```\n\n**import_backup()**\n```bash\nimport_backup() {\n    local archive=\"$1\"\n    local backup_root\n    backup_root=$(get_backup_root)\n    \n    if [[ \"$archive\" != \"-\" ]] && [[ ! -f \"$archive\" ]]; then\n        log_error \"Archive not found: ${archive}\"\n        return 1\n    fi\n    \n    log_step \"Importing from ${archive}...\"\n    \n    # Create backup location if needed\n    mkdir -p \"$backup_root\"\n    \n    # Extract archive\n    if [[ \"$archive\" == \"-\" ]]; then\n        tar -xzf - -C \"$backup_root\"\n    else\n        tar -xzf \"$archive\" -C \"$backup_root\"\n    fi\n    \n    log_success \"Imported backup to ${backup_root}\"\n    log_info \"Run 'asb list' to see imported backups\"\n}\n```\n\n## Important Considerations\n\n### Git History Preservation\n\nThe entire .git directory is included in the archive. This means:\n- Full backup history is preserved\n- Can be used immediately after import\n- No need to re-initialize or lose history\n\n### Conflict Handling\n\nIf the agent already has a backup at the destination:\n- Show warning\n- Require --force to overwrite\n- Or prompt for confirmation in interactive mode\n\n### Stdin/Stdout Support\n\nThe \"-\" argument enables piping:\n```bash\n# Remote transfer\nasb export claude - | ssh remote \"asb import -\"\n\n# S3 backup\nasb export claude - | aws s3 cp - s3://bucket/claude-backup.tar.gz\n\n# Encryption\nasb export claude - | gpg -c > claude-backup.tar.gz.gpg\n```\n\n## Testing Checklist\n\n- [ ] Export creates valid tar.gz\n- [ ] Export includes .git directory\n- [ ] Import extracts to correct location\n- [ ] Imported backup works with asb history\n- [ ] Default filename includes date\n- [ ] Custom filename works\n- [ ] Stdout/stdin piping works\n- [ ] Dry-run shows what would be exported/imported\n- [ ] Force flag handles conflicts","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-19T21:25:14.535112113Z","created_by":"ubuntu","updated_at":"2026-01-20T04:25:47.494362932Z","closed_at":"2026-01-20T04:25:47.494272021Z","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-v3p","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:25:14.550127646Z","created_by":"ubuntu"}]}
{"id":"bd-zkw","title":"Documentation: Update README.md with all new features","description":"# Update README.md with All New Features\n\n## Task\n\nComprehensive update to README.md documenting all v0.2 features.\n\n## Sections to Add/Update\n\n### New Features Section\n```markdown\n## New in v0.2\n\n- **Dry-run mode**: Preview changes with `--dry-run` or `-n`\n- **Restore confirmation**: See exactly what will change before restoring\n- **Configuration file**: Persistent settings in `~/.config/asb/config`\n- **Export/Import**: Portable archives with `asb export` and `asb import`\n- **Shell completion**: Tab completion for bash, zsh, and fish\n```\n\n### Update Installation Section\nAdd shell completion setup instructions.\n\n### Update Usage Section\n- Add global flags (--dry-run, --force, --verbose)\n- Add new commands (config, export, import, completion)\n- Update existing command descriptions\n\n### Add Configuration Section\n```markdown\n## Configuration\n\nasb can be configured via config file or environment variables:\n\n### Config File\n```bash\nasb config init    # Create config file\nasb config show    # View current settings\n```\n\nConfig file location: `~/.config/asb/config`\n\n### Environment Variables\n| Variable | Default | Description |\n|----------|---------|-------------|\n| ASB_BACKUP_ROOT | ~/.agent_settings_backups | Backup location |\n| ASB_AUTO_COMMIT | true | Auto-commit on backup |\n| ASB_VERBOSE | false | Verbose output |\n```\n\n### Add Portability Section\n```markdown\n## Portability\n\nExport backups for transfer between machines:\n```bash\nasb export claude                    # Create archive\nasb import claude-backup.tar.gz     # Import on new machine\n```\n\nPipe support for remote transfer:\n```bash\nasb export claude - | ssh remote \"asb import -\"\n```\n```\n\n## Dependencies\n\nThis task depends on ALL feature implementations being complete,\nas it documents the final state of the tool.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-19T21:27:56.460608522Z","created_by":"ubuntu","updated_at":"2026-01-20T04:08:11.476423737Z","closed_at":"2026-01-20T04:08:11.476370276Z","close_reason":"done","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-zkw","depends_on_id":"bd-1as","type":"blocks","created_at":"2026-01-19T21:29:32.412726959Z","created_by":"ubuntu"},{"issue_id":"bd-zkw","depends_on_id":"bd-1he","type":"blocks","created_at":"2026-01-19T21:29:32.723220659Z","created_by":"ubuntu"},{"issue_id":"bd-zkw","depends_on_id":"bd-1i7","type":"blocks","created_at":"2026-01-19T21:29:32.249411627Z","created_by":"ubuntu"},{"issue_id":"bd-zkw","depends_on_id":"bd-21x","type":"blocks","created_at":"2026-01-19T21:29:32.567933518Z","created_by":"ubuntu"},{"issue_id":"bd-zkw","depends_on_id":"bd-30d","type":"blocks","created_at":"2026-01-19T21:29:32.878857769Z","created_by":"ubuntu"},{"issue_id":"bd-zkw","depends_on_id":"bd-3u9","type":"parent-child","created_at":"2026-01-19T21:27:56.479522858Z","created_by":"ubuntu"}]}
